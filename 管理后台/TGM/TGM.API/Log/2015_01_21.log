#Software: iisexpress
#ProcessID: 8204
#AppDomain: /LM/W3SVC/2/ROOT-1-130662796407083023
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
10:07:25.077 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
10:07:25.086 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
10:07:25.087 1 N - 使用数据库方式：独占，加大缓存权重
10:07:25.087 1 N - 一级缓存：关闭缓存
10:07:25.123 1 N - [DB]GetSchema("MetaDataCollections")
10:07:25.147 1 N - [DB]GetSchema("ReservedWords")
10:07:25.161 1 N - [DB]GetSchema("Databases", "tgm")
10:07:25.269 1 N - [DB]GetSchema("Tables")
10:07:25.404 1 N - [DB]GetSchema("Columns")
10:07:25.454 1 N - [DB]GetSchema("Indexes")
10:07:25.489 1 N - [DB]GetSchema("IndexColumns")
10:07:25.524 1 N - [DB]GetSchema("DataTypes")
10:07:25.644 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:07:25.678 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
10:07:25.765 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:07:25.765 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:07:25.766 1 N - DB待检查表架构的实体个数：8
10:07:25.890 1 N - 检查连接[DB/SqlServer]的数据库架构耗时211ms
10:07:25.890 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
10:07:25.922 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
10:07:25.945 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

10:07:25.970 1 N - 初始化数据库及脚本
10:07:25.977 1 N - [tgm]GetSchema("MetaDataCollections")
10:07:25.980 1 N - [tgm]GetSchema("ReservedWords")
10:07:25.985 1 N - [tgm]GetSchema("Databases", "tgm")
10:07:26.050 1 N - [tgm]GetSchema("Tables")
10:07:26.163 1 N - [tgm]GetSchema("Columns")
10:07:26.206 1 N - [tgm]GetSchema("Indexes")
10:07:26.242 1 N - [tgm]GetSchema("IndexColumns")
10:07:26.282 1 N - [tgm]GetSchema("DataTypes")
10:07:26.376 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
10:07:26.424 1 N - [tgm]的所有实体类（0个）：
10:07:26.424 1 N - [tgm]需要检查架构的实体类（0个）：
10:07:26.424 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时47ms
10:07:26.424 1 N - Select * From tgm_server Order By id Desc
10:07:26.460 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
10:07:26.463 1 N - [7_1_DY-04]GetSchema("ReservedWords")
10:07:26.469 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
10:07:26.549 1 N - [7_1_DY-04]GetSchema("Tables")
10:07:26.716 1 N - [7_1_DY-04]GetSchema("Columns")
10:07:26.829 1 N - [7_1_DY-04]GetSchema("Indexes")
10:07:26.868 1 N - [7_1_DY-04]GetSchema("IndexColumns")
10:07:26.913 1 N - [7_1_DY-04]GetSchema("DataTypes")
10:07:27.004 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
10:07:27.051 1 N - [7_1_DY-04]的所有实体类（0个）：
10:07:27.051 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
10:07:27.051 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时47ms
10:07:27.051 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:07:27.077 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
10:07:27.140 1 N - 单服作业失败
10:07:27.146 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
10:07:27.149 1 N - [6_4_DY-03]GetSchema("ReservedWords")
10:07:27.156 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
10:07:27.233 1 N - [6_4_DY-03]GetSchema("Tables")
10:07:27.405 1 N - [6_4_DY-03]GetSchema("Columns")
10:07:27.522 1 N - [6_4_DY-03]GetSchema("Indexes")
10:07:27.561 1 N - [6_4_DY-03]GetSchema("IndexColumns")
10:07:27.601 1 N - [6_4_DY-03]GetSchema("DataTypes")
10:07:27.689 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
10:07:27.735 1 N - [6_4_DY-03]的所有实体类（0个）：
10:07:27.735 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
10:07:27.736 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时47ms
10:07:27.736 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:07:27.758 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
10:07:27.808 1 N - 单服作业失败
10:07:27.813 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
10:07:27.817 1 N - [1_1_DY-02]GetSchema("ReservedWords")
10:07:27.823 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
10:07:27.898 1 N - [1_1_DY-02]GetSchema("Tables")
10:07:28.054 1 N - [1_1_DY-02]GetSchema("Columns")
10:07:28.182 1 N - [1_1_DY-02]GetSchema("Indexes")
10:07:28.226 1 N - [1_1_DY-02]GetSchema("IndexColumns")
10:07:28.271 1 N - [1_1_DY-02]GetSchema("DataTypes")
10:07:28.369 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
10:07:28.416 1 N - [1_1_DY-02]的所有实体类（0个）：
10:07:28.416 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
10:07:28.416 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时47ms
10:07:28.416 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:07:28.453 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
10:07:28.607 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 4, 12, 0, 16, 5, 8, 5, 0, 0, 0, 23020, 23020, 635574316484747511);Select SCOPE_IDENTITY()
10:07:36.034 7 W - [tgm]GetSchema("Tables")
10:07:36.289 7 W - [tgm]GetSchema("Columns")
10:07:36.373 7 W - [tgm]GetSchema("Indexes")
10:07:36.449 7 W - [tgm]GetSchema("IndexColumns")
10:07:36.528 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:07:36.599 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
10:07:36.670 7 W - Select * From tgm_platform Where id=1
10:07:37.897 9 W - [tgm]GetSchema("Tables")
10:07:38.143 9 W - [tgm]GetSchema("Columns")
10:07:38.229 9 W - [tgm]GetSchema("Indexes")
10:07:38.303 9 W - [tgm]GetSchema("IndexColumns")
10:07:38.385 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:07:38.456 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:07:38.523 9 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
10:07:38.587 9 W - Select * From tgm_platform Where id=1
10:07:38.660 9 W - Select * From tgm_platform Where id=1
10:07:44.985 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:07:45.053 8 W - Select * From tgm_platform Order By  createtime desc
10:07:51.879 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:07:51.945 7 W - Select * From tgm_server Where [pid] =1  Order By  createtime desc
10:07:52.009 7 W - Select * From tgm_platform Where id=1
10:07:52.076 7 W - Select * From tgm_platform Where id=1
10:08:03.198 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:08:03.265 7 W - Select * From tgm_platform Order By  createtime desc
10:08:05.520 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:08:05.584 8 W - Select * From tgm_role Where id=1
10:08:05.647 8 W - Select * From tgm_platform Where id=1
10:08:05.785 8 W - [tgm]GetSchema("Tables")
10:08:06.030 8 W - [tgm]GetSchema("Columns")
10:08:06.115 8 W - [tgm]GetSchema("Indexes")
10:08:06.187 8 W - [tgm]GetSchema("IndexColumns")
10:08:06.262 8 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 1, 1, '', N'', 635574316857093459, 1, 1, '就应该', 3, 0, 0, 0, 0, 0, 0, 0, '');Select SCOPE_IDENTITY()
10:08:11.399 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:08:11.470 7 W - Select * From tgm_role Where id=1
10:08:11.534 7 W - Select * From tgm_resource Order By id Desc
10:08:11.598 7 W - Select * From tgm_platform Where id in (1,1) Order By id Desc
10:08:11.665 7 W - Select * From tgm_server Where id in (1,1) Order By id Desc
10:08:12.940 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:08:13.005 8 W - Select * From tgm_platform Order By  createtime desc
10:08:53.506 9 Y - Select * From tgm_server Order By id Desc
10:08:53.760 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:08:53.990 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:08:53.990 9 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:08:54.881 9 Y - 单服作业失败
10:08:54.882 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:08:55.867 9 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:08:57.336 9 Y - 单服作业失败
10:08:57.337 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:08:57.755 8 W - Select * From tgm_resource Where id=3
10:08:58.814 9 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:08:59.620 9 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 10, 0, 16, 6, 8, 7, 0, 0, 0, 23020, 23020, 635574317392143411);Select SCOPE_IDENTITY()
10:08:59.643 8 W - Update tgm_resource Set [state]=2, [operation]=N'admin' Where id=3
10:09:14.830 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:09:14.917 8 W - Select * From tgm_role Where id=1
10:09:14.979 8 W - Select * From tgm_resource Order By id Desc
10:09:15.037 8 W - Select * From tgm_platform Where id in (1,1) Order By id Desc
10:09:15.102 8 W - Select * From tgm_server Where id in (1,1) Order By id Desc
10:09:16.197 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:09:16.265 7 W - Select * From tgm_platform Order By  createtime desc
10:09:52.074 7 Y - Select * From tgm_server Order By id Desc
10:09:52.096 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:09:52.116 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:09:52.173 7 Y - 单服作业失败
10:09:52.173 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:09:52.193 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:09:52.231 7 Y - 单服作业失败
10:09:52.231 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:09:52.250 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:09:52.268 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 5, 11, 0, 16, 6, 8, 7, 0, 0, 0, 23020, 23020, 635574317922672307);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 8972
#AppDomain: /LM/W3SVC/2/ROOT-1-130662798285595551
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
10:10:33.371 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
10:10:33.379 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
10:10:33.380 1 N - 使用数据库方式：独占，加大缓存权重
10:10:33.380 1 N - 一级缓存：关闭缓存
10:10:33.407 1 N - [DB]GetSchema("MetaDataCollections")
10:10:33.432 1 N - [DB]GetSchema("ReservedWords")
10:10:33.445 1 N - [DB]GetSchema("Databases", "tgm")
10:10:33.533 1 N - [DB]GetSchema("Tables")
10:10:33.667 1 N - [DB]GetSchema("Columns")
10:10:33.709 1 N - [DB]GetSchema("Indexes")
10:10:33.741 1 N - [DB]GetSchema("IndexColumns")
10:10:33.776 1 N - [DB]GetSchema("DataTypes")
10:10:33.882 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:10:33.926 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
10:10:34.010 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:10:34.010 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:10:34.010 1 N - DB待检查表架构的实体个数：8
10:10:34.135 1 N - 检查连接[DB/SqlServer]的数据库架构耗时209ms
10:10:34.135 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
10:10:34.166 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
10:10:34.191 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

10:10:34.214 1 N - 初始化数据库及脚本
10:10:34.221 1 N - [tgm]GetSchema("MetaDataCollections")
10:10:34.224 1 N - [tgm]GetSchema("ReservedWords")
10:10:34.229 1 N - [tgm]GetSchema("Databases", "tgm")
10:10:34.295 1 N - [tgm]GetSchema("Tables")
10:10:34.439 1 N - [tgm]GetSchema("Columns")
10:10:34.481 1 N - [tgm]GetSchema("Indexes")
10:10:34.511 1 N - [tgm]GetSchema("IndexColumns")
10:10:34.544 1 N - [tgm]GetSchema("DataTypes")
10:10:34.625 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
10:10:34.672 1 N - [tgm]的所有实体类（0个）：
10:10:34.672 1 N - [tgm]需要检查架构的实体类（0个）：
10:10:34.672 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时47ms
10:10:34.672 1 N - Select * From tgm_server Order By id Desc
10:10:34.709 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
10:10:34.712 1 N - [7_1_DY-04]GetSchema("ReservedWords")
10:10:34.718 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
10:10:34.794 1 N - [7_1_DY-04]GetSchema("Tables")
10:10:34.958 1 N - [7_1_DY-04]GetSchema("Columns")
10:10:35.074 1 N - [7_1_DY-04]GetSchema("Indexes")
10:10:35.115 1 N - [7_1_DY-04]GetSchema("IndexColumns")
10:10:35.157 1 N - [7_1_DY-04]GetSchema("DataTypes")
10:10:35.246 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
10:10:35.293 1 N - [7_1_DY-04]的所有实体类（0个）：
10:10:35.293 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
10:10:35.293 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时47ms
10:10:35.293 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:10:35.318 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
10:10:35.378 1 N - 单服作业失败
10:10:35.383 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
10:10:35.386 1 N - [6_4_DY-03]GetSchema("ReservedWords")
10:10:35.392 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
10:10:35.471 1 N - [6_4_DY-03]GetSchema("Tables")
10:10:35.626 1 N - [6_4_DY-03]GetSchema("Columns")
10:10:35.748 1 N - [6_4_DY-03]GetSchema("Indexes")
10:10:35.819 1 N - [6_4_DY-03]GetSchema("IndexColumns")
10:10:35.872 1 N - [6_4_DY-03]GetSchema("DataTypes")
10:10:35.968 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
10:10:36.016 1 N - [6_4_DY-03]的所有实体类（0个）：
10:10:36.016 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
10:10:36.016 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时48ms
10:10:36.016 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:10:36.040 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
10:10:36.090 1 N - 单服作业失败
10:10:36.096 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
10:10:36.099 1 N - [1_1_DY-02]GetSchema("ReservedWords")
10:10:36.104 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
10:10:36.175 1 N - [1_1_DY-02]GetSchema("Tables")
10:10:36.340 1 N - [1_1_DY-02]GetSchema("Columns")
10:10:36.461 1 N - [1_1_DY-02]GetSchema("Indexes")
10:10:36.497 1 N - [1_1_DY-02]GetSchema("IndexColumns")
10:10:36.538 1 N - [1_1_DY-02]GetSchema("DataTypes")
10:10:36.631 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
10:10:36.678 1 N - [1_1_DY-02]的所有实体类（0个）：
10:10:36.678 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
10:10:36.678 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时47ms
10:10:36.678 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:10:36.705 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
10:10:36.858 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 4, 12, 0, 16, 6, 8, 7, 0, 0, 0, 23020, 23020, 635574318367272145);Select SCOPE_IDENTITY()
10:10:41.313 9 W - [tgm]GetSchema("Tables")
10:10:41.552 9 W - [tgm]GetSchema("Columns")
10:10:41.635 9 W - [tgm]GetSchema("Indexes")
10:10:41.723 9 W - [tgm]GetSchema("IndexColumns")
10:10:41.796 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:10:41.869 9 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
10:10:41.938 9 W - Select * From tgm_platform Where id=1
10:10:43.320 8 W - [tgm]GetSchema("Tables")
10:10:43.567 8 W - [tgm]GetSchema("Columns")
10:10:43.652 8 W - [tgm]GetSchema("Indexes")
10:10:43.730 8 W - [tgm]GetSchema("IndexColumns")
10:10:43.808 8 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:10:43.884 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:10:43.947 8 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
10:10:44.008 8 W - Select * From tgm_platform Where id=1
10:10:44.075 8 W - Select * From tgm_platform Where id=1
10:10:49.956 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:10:50.023 7 W - Select * From tgm_platform Order By  createtime desc
10:10:56.866 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:10:56.929 7 W - Select * From tgm_server Where [pid] =1  Order By  createtime desc
10:10:56.990 7 W - Select * From tgm_platform Where id=1
10:10:57.057 7 W - Select * From tgm_platform Where id=1
10:11:27.465 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:27.528 8 W - Select * From tgm_platform Order By  createtime desc
10:11:29.808 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:29.870 7 W - Select * From tgm_role Where id=1
10:11:29.936 7 W - Select * From tgm_platform Where id=1
10:11:30.066 7 W - [tgm]GetSchema("Tables")
10:11:30.297 7 W - [tgm]GetSchema("Columns")
10:11:30.381 7 W - [tgm]GetSchema("Indexes")
10:11:30.452 7 W - [tgm]GetSchema("IndexColumns")
10:11:30.526 7 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 1, 1, '', N'', 635574318899962335, 1, 1, '更好发挥', 44, 0, 0, 0, 0, 0, 0, 0, '');Select SCOPE_IDENTITY()
10:11:34.215 7 Y - Select * From tgm_server Order By id Desc
10:11:34.254 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:11:34.277 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:11:34.330 7 Y - 单服作业失败
10:11:34.330 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:11:34.351 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:11:34.391 7 Y - 单服作业失败
10:11:34.392 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:11:34.413 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:11:34.430 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 4, 12, 0, 16, 6, 8, 7, 0, 0, 0, 23020, 23020, 635574318944292112);Select SCOPE_IDENTITY()
10:11:36.757 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:36.827 7 W - Select * From tgm_role Where id=1
10:11:36.892 7 W - Select * From tgm_resource Order By id Desc
10:11:36.958 7 W - Select * From tgm_platform Where id in (1,1,1) Order By id Desc
10:11:37.020 7 W - Select * From tgm_server Where id in (1,1,1) Order By id Desc
10:11:38.289 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:38.355 9 W - Select * From tgm_platform Order By  createtime desc
10:11:51.782 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:51.846 7 W - Select * From tgm_resource Where id=4
10:11:51.935 7 W - Update tgm_resource Set [state]=2, [operation]=N'admin' Where id=4
10:11:53.439 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:53.503 9 W - Select * From tgm_role Where id=1
10:11:53.566 9 W - Select * From tgm_resource Order By id Desc
10:11:53.628 9 W - Select * From tgm_platform Where id in (1,1,1) Order By id Desc
10:11:53.694 9 W - Select * From tgm_server Where id in (1,1,1) Order By id Desc
10:11:54.795 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:11:54.859 7 W - Select * From tgm_platform Order By  createtime desc
10:12:06.268 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:12:06.336 7 W - Select * From tgm_platform Order By  createtime desc
10:12:08.646 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:12:08.714 7 W - Select * From tgm_role Where id=1
10:12:08.775 7 W - Select * From tgm_resource Order By id Desc
10:12:08.836 7 W - Select * From tgm_platform Where id in (1,1,1) Order By id Desc
10:12:08.899 7 W - Select * From tgm_server Where id in (1,1,1) Order By id Desc
10:12:10.012 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:12:10.077 8 W - Select * From tgm_platform Order By  createtime desc
10:12:11.534 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:12:11.600 9 W - Select * From tgm_platform Order By  createtime desc
10:12:13.966 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:12:14.035 7 W - Select * From tgm_role Where id=1
10:12:14.097 7 W - Select * From tgm_resource Order By id Desc
10:12:14.158 7 W - Select * From tgm_platform Where id in (1,1,1) Order By id Desc
10:12:14.219 7 W - Select * From tgm_server Where id in (1,1,1) Order By id Desc
10:12:15.316 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:12:15.384 8 W - Select * From tgm_platform Order By  createtime desc
10:12:34.217 7 Y - Select * From tgm_server Order By id Desc
10:12:34.256 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:12:34.283 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:12:34.328 7 Y - 单服作业失败
10:12:34.328 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:12:34.347 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:12:34.390 7 Y - 单服作业失败
10:12:34.390 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:12:34.411 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:12:34.429 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 4, 12, 0, 16, 6, 8, 7, 0, 0, 0, 23020, 23020, 635574319544280217);Select SCOPE_IDENTITY()
10:13:13.851 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:13:13.917 8 W - Select * From tgm_platform Order By  createtime desc
10:13:34.222 8 Y - Select * From tgm_server Order By id Desc
10:13:34.266 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:13:34.311 8 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:13:34.370 8 Y - 单服作业失败
10:13:34.370 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:13:34.394 8 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:13:34.442 8 Y - 单服作业失败
10:13:34.442 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:13:34.466 8 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:13:34.487 8 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 5, 11, 0, 16, 6, 8, 7, 0, 0, 0, 23020, 23020, 635574320144864441);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 8524
#AppDomain: /LM/W3SVC/2/ROOT-1-130662808067914571
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
10:26:51.646 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
10:26:51.654 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
10:26:51.654 1 N - 使用数据库方式：独占，加大缓存权重
10:26:51.654 1 N - 一级缓存：关闭缓存
10:26:51.682 1 N - [DB]GetSchema("MetaDataCollections")
10:26:51.726 1 N - [DB]GetSchema("ReservedWords")
10:26:51.740 1 N - [DB]GetSchema("Databases", "tgm")
10:26:51.822 1 N - [DB]GetSchema("Tables")
10:26:51.952 1 N - [DB]GetSchema("Columns")
10:26:51.995 1 N - [DB]GetSchema("Indexes")
10:26:52.026 1 N - [DB]GetSchema("IndexColumns")
10:26:52.063 1 N - [DB]GetSchema("DataTypes")
10:26:52.174 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:26:52.209 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
10:26:52.286 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:26:52.286 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:26:52.287 1 N - DB待检查表架构的实体个数：8
10:26:52.416 1 N - 检查连接[DB/SqlServer]的数据库架构耗时207ms
10:26:52.416 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
10:26:52.450 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
10:26:52.475 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

10:26:52.499 1 N - 初始化数据库及脚本
10:26:52.506 1 N - [tgm]GetSchema("MetaDataCollections")
10:26:52.510 1 N - [tgm]GetSchema("ReservedWords")
10:26:52.515 1 N - [tgm]GetSchema("Databases", "tgm")
10:26:52.598 1 N - [tgm]GetSchema("Tables")
10:26:52.805 1 N - [tgm]GetSchema("Columns")
10:26:52.851 1 N - [tgm]GetSchema("Indexes")
10:26:52.885 1 N - [tgm]GetSchema("IndexColumns")
10:26:52.918 1 N - [tgm]GetSchema("DataTypes")
10:26:53.002 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
10:26:53.050 1 N - [tgm]的所有实体类（0个）：
10:26:53.050 1 N - [tgm]需要检查架构的实体类（0个）：
10:26:53.050 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时47ms
10:26:53.050 1 N - Select * From tgm_server Order By id Desc
10:26:53.094 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
10:26:53.097 1 N - [7_1_DY-04]GetSchema("ReservedWords")
10:26:53.102 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
10:26:53.182 1 N - [7_1_DY-04]GetSchema("Tables")
10:26:53.352 1 N - [7_1_DY-04]GetSchema("Columns")
10:26:53.467 1 N - [7_1_DY-04]GetSchema("Indexes")
10:26:53.506 1 N - [7_1_DY-04]GetSchema("IndexColumns")
10:26:53.548 1 N - [7_1_DY-04]GetSchema("DataTypes")
10:26:53.640 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
10:26:53.687 1 N - [7_1_DY-04]的所有实体类（0个）：
10:26:53.687 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
10:26:53.687 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时47ms
10:26:53.687 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:26:53.713 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
10:26:53.772 1 N - 单服作业失败
10:26:53.777 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
10:26:53.780 1 N - [6_4_DY-03]GetSchema("ReservedWords")
10:26:53.786 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
10:26:53.870 1 N - [6_4_DY-03]GetSchema("Tables")
10:26:54.039 1 N - [6_4_DY-03]GetSchema("Columns")
10:26:54.156 1 N - [6_4_DY-03]GetSchema("Indexes")
10:26:54.193 1 N - [6_4_DY-03]GetSchema("IndexColumns")
10:26:54.235 1 N - [6_4_DY-03]GetSchema("DataTypes")
10:26:54.333 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
10:26:54.380 1 N - [6_4_DY-03]的所有实体类（0个）：
10:26:54.380 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
10:26:54.380 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时47ms
10:26:54.381 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:26:54.406 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
10:26:54.470 1 N - 单服作业失败
10:26:54.475 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
10:26:54.478 1 N - [1_1_DY-02]GetSchema("ReservedWords")
10:26:54.484 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
10:26:54.553 1 N - [1_1_DY-02]GetSchema("Tables")
10:26:54.717 1 N - [1_1_DY-02]GetSchema("Columns")
10:26:54.835 1 N - [1_1_DY-02]GetSchema("Indexes")
10:26:54.880 1 N - [1_1_DY-02]GetSchema("IndexColumns")
10:26:54.923 1 N - [1_1_DY-02]GetSchema("DataTypes")
10:26:55.014 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
10:26:55.061 1 N - [1_1_DY-02]的所有实体类（0个）：
10:26:55.061 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
10:26:55.061 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时48ms
10:26:55.062 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:26:55.087 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
10:26:55.244 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 7, 8, 11, 0, 0, 0, 23020, 23020, 635574328151082049);Select SCOPE_IDENTITY()
10:27:02.054 7 W - [tgm]GetSchema("Tables")
10:27:02.301 7 W - [tgm]GetSchema("Columns")
10:27:02.387 7 W - [tgm]GetSchema("Indexes")
10:27:02.470 7 W - [tgm]GetSchema("IndexColumns")
10:27:02.548 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:27:02.618 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
10:27:02.690 7 W - Select * From tgm_platform Where id=1
10:27:04.118 9 W - [tgm]GetSchema("Tables")
10:27:04.378 9 W - [tgm]GetSchema("Columns")
10:27:04.467 9 W - [tgm]GetSchema("Indexes")
10:27:04.543 9 W - [tgm]GetSchema("IndexColumns")
10:27:04.624 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:27:04.701 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:27:04.767 9 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
10:27:04.835 9 W - Select * From tgm_platform Where id=1
10:27:04.909 9 W - Select * From tgm_platform Where id=1
10:27:12.678 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:27:12.747 7 W - Select * From tgm_platform Order By  createtime desc
10:27:25.606 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:27:25.677 7 W - Select * From tgm_server Where [pid] =1  Order By  createtime desc
10:27:25.740 7 W - Select * From tgm_platform Where id=1
10:27:25.807 7 W - Select * From tgm_platform Where id=1
10:27:50.429 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:27:50.498 7 W - Select * From tgm_platform Order By  createtime desc
10:27:52.734 7 Y - Select * From tgm_server Order By id Desc
10:27:52.825 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:27:52.910 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:27:53.014 7 Y - 单服作业失败
10:27:53.014 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:27:53.034 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:27:53.074 7 Y - 单服作业失败
10:27:53.074 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:27:53.075 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:27:53.164 8 W - Select * From tgm_role Where id=1
10:27:53.165 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:27:53.241 8 W - Select * From tgm_platform Where id=1
10:27:53.304 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574328732428202);Select SCOPE_IDENTITY()
10:27:53.395 8 W - [tgm]GetSchema("Tables")
10:27:53.640 8 W - [tgm]GetSchema("Columns")
10:27:53.723 8 W - [tgm]GetSchema("Indexes")
10:27:53.795 8 W - [tgm]GetSchema("IndexColumns")
10:27:53.877 8 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 1, 1, N'', N'lgy', 635574328733237569, 2, 1, '房东', 122, 0, 0, 0, 0, 0, 0, 0, '');Select SCOPE_IDENTITY()
10:27:58.862 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:27:58.934 9 W - Select * From tgm_role Where id=1
10:27:59.000 9 W - Select * From tgm_resource Order By id Desc
10:27:59.070 9 W - Select * From tgm_platform Where id in (1,1,1,1) Order By id Desc
10:27:59.135 9 W - Select * From tgm_server Where id in (1,1,1,1) Order By id Desc
10:28:00.463 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:28:00.530 7 W - Select * From tgm_platform Order By  createtime desc
10:28:37.420 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:28:37.487 7 W - Select * From tgm_platform Order By  createtime desc
10:28:52.543 7 Y - Select * From tgm_server Order By id Desc
10:28:52.584 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:28:52.611 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:28:52.650 7 Y - 单服作业失败
10:28:52.650 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:28:52.670 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:28:52.709 7 Y - 单服作业失败
10:28:52.710 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:28:52.730 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:28:52.752 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574329327511246);Select SCOPE_IDENTITY()
10:29:17.199 11 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:29:17.267 11 W - Select * From tgm_role Where id=1
10:29:17.332 11 W - Select * From tgm_resource Order By id Desc
10:29:17.394 11 W - Select * From tgm_platform Where id in (1,1,1,1) Order By id Desc
10:29:17.456 11 W - Select * From tgm_server Where id in (1,1,1,1) Order By id Desc
10:29:18.614 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:29:18.679 8 W - Select * From tgm_platform Order By  createtime desc
10:29:20.625 12 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:29:20.692 12 W - Select * From tgm_platform Order By  createtime desc

#Software: iisexpress
#ProcessID: 8772
#AppDomain: /LM/W3SVC/2/ROOT-1-130662810619564721
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
10:31:07.230 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
10:31:07.238 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
10:31:07.238 1 N - 使用数据库方式：独占，加大缓存权重
10:31:07.238 1 N - 一级缓存：关闭缓存
10:31:07.267 1 N - [DB]GetSchema("MetaDataCollections")
10:31:07.295 1 N - [DB]GetSchema("ReservedWords")
10:31:07.310 1 N - [DB]GetSchema("Databases", "tgm")
10:31:07.388 1 N - [DB]GetSchema("Tables")
10:31:07.501 1 N - [DB]GetSchema("Columns")
10:31:07.553 1 N - [DB]GetSchema("Indexes")
10:31:07.588 1 N - [DB]GetSchema("IndexColumns")
10:31:07.625 1 N - [DB]GetSchema("DataTypes")
10:31:07.736 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:31:07.790 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
10:31:07.867 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:31:07.867 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:31:07.867 1 N - DB待检查表架构的实体个数：8
10:31:07.984 1 N - 检查连接[DB/SqlServer]的数据库架构耗时194ms
10:31:07.984 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
10:31:08.016 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
10:31:08.039 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

10:31:08.063 1 N - 初始化数据库及脚本
10:31:08.070 1 N - [tgm]GetSchema("MetaDataCollections")
10:31:08.073 1 N - [tgm]GetSchema("ReservedWords")
10:31:08.080 1 N - [tgm]GetSchema("Databases", "tgm")
10:31:08.155 1 N - [tgm]GetSchema("Tables")
10:31:08.276 1 N - [tgm]GetSchema("Columns")
10:31:08.327 1 N - [tgm]GetSchema("Indexes")
10:31:08.364 1 N - [tgm]GetSchema("IndexColumns")
10:31:08.400 1 N - [tgm]GetSchema("DataTypes")
10:31:08.496 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
10:31:08.557 1 N - [tgm]的所有实体类（0个）：
10:31:08.557 1 N - [tgm]需要检查架构的实体类（0个）：
10:31:08.557 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时61ms
10:31:08.557 1 N - Select * From tgm_server Order By id Desc
10:31:08.611 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
10:31:08.614 1 N - [7_1_DY-04]GetSchema("ReservedWords")
10:31:08.620 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
10:31:08.690 1 N - [7_1_DY-04]GetSchema("Tables")
10:31:08.842 1 N - [7_1_DY-04]GetSchema("Columns")
10:31:08.967 1 N - [7_1_DY-04]GetSchema("Indexes")
10:31:09.006 1 N - [7_1_DY-04]GetSchema("IndexColumns")
10:31:09.048 1 N - [7_1_DY-04]GetSchema("DataTypes")
10:31:09.140 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
10:31:09.188 1 N - [7_1_DY-04]的所有实体类（0个）：
10:31:09.188 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
10:31:09.188 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时47ms
10:31:09.188 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:31:09.213 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
10:31:09.269 1 N - 单服作业失败
10:31:09.274 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
10:31:09.277 1 N - [6_4_DY-03]GetSchema("ReservedWords")
10:31:09.283 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
10:31:09.350 1 N - [6_4_DY-03]GetSchema("Tables")
10:31:09.507 1 N - [6_4_DY-03]GetSchema("Columns")
10:31:09.622 1 N - [6_4_DY-03]GetSchema("Indexes")
10:31:09.665 1 N - [6_4_DY-03]GetSchema("IndexColumns")
10:31:09.707 1 N - [6_4_DY-03]GetSchema("DataTypes")
10:31:09.792 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
10:31:09.838 1 N - [6_4_DY-03]的所有实体类（0个）：
10:31:09.838 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
10:31:09.838 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时46ms
10:31:09.838 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:31:09.862 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
10:31:09.907 1 N - 单服作业失败
10:31:09.913 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
10:31:09.916 1 N - [1_1_DY-02]GetSchema("ReservedWords")
10:31:09.922 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
10:31:09.986 1 N - [1_1_DY-02]GetSchema("Tables")
10:31:10.148 1 N - [1_1_DY-02]GetSchema("Columns")
10:31:10.266 1 N - [1_1_DY-02]GetSchema("Indexes")
10:31:10.302 1 N - [1_1_DY-02]GetSchema("IndexColumns")
10:31:10.341 1 N - [1_1_DY-02]GetSchema("DataTypes")
10:31:10.431 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
10:31:10.478 1 N - [1_1_DY-02]的所有实体类（0个）：
10:31:10.478 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
10:31:10.478 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时47ms
10:31:10.479 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:31:10.504 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
10:31:10.665 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574330705260636);Select SCOPE_IDENTITY()
10:31:20.241 7 W - [tgm]GetSchema("Tables")
10:31:20.474 7 W - [tgm]GetSchema("Columns")
10:31:20.554 7 W - [tgm]GetSchema("Indexes")
10:31:20.640 7 W - [tgm]GetSchema("IndexColumns")
10:31:20.714 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:31:20.782 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
10:31:20.853 7 W - Select * From tgm_platform Where id=1
10:31:22.206 8 W - [tgm]GetSchema("Tables")
10:31:22.442 8 W - [tgm]GetSchema("Columns")
10:31:22.529 8 W - [tgm]GetSchema("Indexes")
10:31:22.604 8 W - [tgm]GetSchema("IndexColumns")
10:31:22.679 8 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:31:22.747 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:31:22.816 8 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
10:31:22.876 8 W - Select * From tgm_platform Where id=1
10:31:22.945 8 W - Select * From tgm_platform Where id=1
10:31:33.834 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:31:33.901 7 W - Select * From tgm_platform Order By  createtime desc
10:32:08.081 7 Y - Select * From tgm_server Order By id Desc
10:32:08.125 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:32:08.153 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:32:08.196 7 Y - 单服作业失败
10:32:08.196 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:32:08.216 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:32:08.255 7 Y - 单服作业失败
10:32:08.255 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:32:08.276 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:32:08.295 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574331282947008);Select SCOPE_IDENTITY()
10:32:57.285 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:32:57.351 8 W - Select * From tgm_role Where id=1
10:32:57.484 8 W - [tgm]GetSchema("Tables")
10:32:57.723 8 W - [tgm]GetSchema("Columns")
10:32:57.803 8 W - [tgm]GetSchema("Indexes")
10:32:57.874 8 W - [tgm]GetSchema("IndexColumns")
10:32:57.949 8 W - Select * From tgm_resource Order By id Desc
10:32:58.018 8 W - Select * From tgm_platform Where id in (1,1,1,1) Order By id Desc
10:32:58.081 8 W - Select * From tgm_server Where id in (1,1,1,1) Order By id Desc
10:32:59.384 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:32:59.453 9 W - Select * From tgm_platform Order By  createtime desc
10:33:03.988 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:04.052 8 W - Select * From tgm_platform Order By  createtime desc
10:33:07.497 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:07.562 10 W - Select * From tgm_server Where [pid] =1  Order By  createtime desc
10:33:07.623 10 W - Select * From tgm_platform Where id=1
10:33:07.691 10 W - Select * From tgm_platform Where id=1
10:33:08.113 8 Y - Select * From tgm_server Order By id Desc
10:33:08.177 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:33:08.234 8 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:33:08.383 8 Y - 单服作业失败
10:33:08.384 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:33:08.437 8 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:33:08.541 8 Y - 单服作业失败
10:33:08.541 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:33:08.568 8 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:33:08.588 8 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574331885873376);Select SCOPE_IDENTITY()
10:33:22.499 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:22.563 8 W - Select * From tgm_platform Order By  createtime desc
10:33:24.877 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:24.943 10 W - Select * From tgm_role Where id=1
10:33:25.004 10 W - Select * From tgm_platform Where id=1
10:33:25.067 10 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 1, 1, N'发大水', N'', 635574332050654232, 2, 1, '房东', 45, 0, 0, 0, 0, 0, 0, 0, '');Select SCOPE_IDENTITY()
10:33:29.077 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:29.138 10 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:33:29.198 10 W - Select * From tgm_platform Where id=4
10:33:40.586 13 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:40.652 13 W - Select * From tgm_platform Order By  createtime desc
10:33:49.034 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:33:49.096 10 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:33:49.163 10 W - Select * From tgm_platform Where id=4
10:34:08.120 10 Y - Select * From tgm_server Order By id Desc
10:34:08.142 10 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:34:08.166 10 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:34:08.209 10 Y - 单服作业失败
10:34:08.210 10 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:34:08.230 10 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:34:08.269 10 Y - 单服作业失败
10:34:08.269 10 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:34:08.291 10 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:34:08.308 10 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574332483065907);Select SCOPE_IDENTITY()
10:34:10.924 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:34:10.990 10 W - Select * From tgm_platform Order By  createtime desc
10:34:13.292 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:34:13.353 9 W - Select * From tgm_role Where id=1
10:34:13.411 9 W - Select * From tgm_platform Where id=4
10:34:13.474 9 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 4, 6, '', N'', 635574332534731849, 1, 1, '32', 23, 54, 45, 0, 54, 45, 54, 54, '');Select SCOPE_IDENTITY()
10:34:17.318 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:34:17.380 9 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:34:17.441 9 W - Select * From tgm_platform Where id=4
10:34:33.318 11 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:34:33.383 11 W - Select * From tgm_platform Order By  createtime desc
10:34:44.989 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:34:45.051 10 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:34:45.112 10 W - Select * From tgm_platform Where id=4
10:35:00.863 14 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:35:00.930 14 W - Select * From tgm_platform Order By  createtime desc
10:35:08.156 10 Y - Select * From tgm_server Order By id Desc
10:35:08.230 10 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:35:08.300 10 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:35:08.319 14 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:35:08.395 14 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:35:08.462 10 Y - 单服作业失败
10:35:08.462 10 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:35:08.463 14 W - Select * From tgm_platform Where id=4
10:35:08.615 10 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:35:08.850 10 Y - 单服作业失败
10:35:08.901 10 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:35:08.968 10 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:35:09.072 10 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574333090325620);Select SCOPE_IDENTITY()
10:35:27.016 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:35:27.082 10 W - Select * From tgm_platform Order By  createtime desc
10:35:32.194 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:35:32.262 7 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:35:32.321 7 W - Select * From tgm_platform Where id=4
10:36:10.121 17 Y - Select * From tgm_server Order By id Desc
10:36:10.153 17 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:36:10.176 17 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:36:10.591 17 Y - 单服作业失败
10:36:10.591 17 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:36:11.181 17 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:36:11.230 17 Y - 单服作业失败
10:36:11.231 17 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:36:11.256 17 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:36:12.301 17 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 8, 10, 2, 18, 8, 8, 12, 0, 0, 0, 23020, 23020, 635574333723006727);Select SCOPE_IDENTITY()
10:36:19.156 18 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:36:19.220 18 W - Select * From tgm_platform Order By  createtime desc
10:39:13.029 16 Y - Select * From tgm_server Order By id Desc
10:39:13.063 16 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:39:13.086 16 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:39:13.136 16 Y - 单服作业失败
10:39:13.136 16 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:39:13.161 16 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:39:13.208 16 Y - 单服作业失败
10:39:13.208 16 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:39:13.229 16 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:39:13.254 16 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 9, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574335532532107);Select SCOPE_IDENTITY()
10:39:24.046 16 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:39:24.108 16 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:39:24.167 16 W - Select * From tgm_platform Where id=4
10:39:44.713 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:39:44.776 10 W - Select * From tgm_platform Order By  createtime desc
10:39:50.088 10 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:39:50.148 10 W - Select * From tgm_role Where id=1
10:39:50.212 10 W - Select * From tgm_platform Where id=4
10:39:50.275 10 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 4, 6, '', N'', 635574335902733135, 1, 1, '热帖', 434, 0, 0, 213, 0, 0, 0, 0, '');Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 9068
#AppDomain: /LM/W3SVC/2/ROOT-1-130662816349952674
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
10:40:40.250 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
10:40:40.258 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
10:40:40.258 1 N - 使用数据库方式：独占，加大缓存权重
10:40:40.258 1 N - 一级缓存：关闭缓存
10:40:40.286 1 N - [DB]GetSchema("MetaDataCollections")
10:40:40.310 1 N - [DB]GetSchema("ReservedWords")
10:40:40.323 1 N - [DB]GetSchema("Databases", "tgm")
10:40:40.403 1 N - [DB]GetSchema("Tables")
10:40:40.540 1 N - [DB]GetSchema("Columns")
10:40:40.583 1 N - [DB]GetSchema("Indexes")
10:40:40.618 1 N - [DB]GetSchema("IndexColumns")
10:40:40.652 1 N - [DB]GetSchema("DataTypes")
10:40:40.756 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:40:40.789 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
10:40:40.863 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:40:40.863 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
10:40:40.863 1 N - DB待检查表架构的实体个数：8
10:40:40.988 1 N - 检查连接[DB/SqlServer]的数据库架构耗时199ms
10:40:40.988 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
10:40:41.016 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
10:40:41.039 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

10:40:41.061 1 N - 初始化数据库及脚本
10:40:41.069 1 N - [tgm]GetSchema("MetaDataCollections")
10:40:41.072 1 N - [tgm]GetSchema("ReservedWords")
10:40:41.077 1 N - [tgm]GetSchema("Databases", "tgm")
10:40:41.147 1 N - [tgm]GetSchema("Tables")
10:40:41.281 1 N - [tgm]GetSchema("Columns")
10:40:41.324 1 N - [tgm]GetSchema("Indexes")
10:40:41.356 1 N - [tgm]GetSchema("IndexColumns")
10:40:41.391 1 N - [tgm]GetSchema("DataTypes")
10:40:41.474 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
10:40:41.521 1 N - [tgm]的所有实体类（0个）：
10:40:41.521 1 N - [tgm]需要检查架构的实体类（0个）：
10:40:41.521 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时47ms
10:40:41.521 1 N - Select * From tgm_server Order By id Desc
10:40:41.559 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
10:40:41.562 1 N - [7_1_DY-04]GetSchema("ReservedWords")
10:40:41.568 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
10:40:41.645 1 N - [7_1_DY-04]GetSchema("Tables")
10:40:41.807 1 N - [7_1_DY-04]GetSchema("Columns")
10:40:41.922 1 N - [7_1_DY-04]GetSchema("Indexes")
10:40:41.958 1 N - [7_1_DY-04]GetSchema("IndexColumns")
10:40:41.997 1 N - [7_1_DY-04]GetSchema("DataTypes")
10:40:42.088 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
10:40:42.135 1 N - [7_1_DY-04]的所有实体类（0个）：
10:40:42.136 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
10:40:42.136 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时47ms
10:40:42.136 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:40:42.160 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
10:40:42.216 1 N - 单服作业失败
10:40:42.221 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
10:40:42.224 1 N - [6_4_DY-03]GetSchema("ReservedWords")
10:40:42.231 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
10:40:42.305 1 N - [6_4_DY-03]GetSchema("Tables")
10:40:42.467 1 N - [6_4_DY-03]GetSchema("Columns")
10:40:42.585 1 N - [6_4_DY-03]GetSchema("Indexes")
10:40:42.645 1 N - [6_4_DY-03]GetSchema("IndexColumns")
10:40:42.684 1 N - [6_4_DY-03]GetSchema("DataTypes")
10:40:42.771 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
10:40:42.826 1 N - [6_4_DY-03]的所有实体类（0个）：
10:40:42.826 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
10:40:42.826 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时54ms
10:40:42.826 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:40:42.850 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
10:40:42.898 1 N - 单服作业失败
10:40:42.903 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
10:40:42.906 1 N - [1_1_DY-02]GetSchema("ReservedWords")
10:40:42.912 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
10:40:42.977 1 N - [1_1_DY-02]GetSchema("Tables")
10:40:43.143 1 N - [1_1_DY-02]GetSchema("Columns")
10:40:43.265 1 N - [1_1_DY-02]GetSchema("Indexes")
10:40:43.310 1 N - [1_1_DY-02]GetSchema("IndexColumns")
10:40:43.351 1 N - [1_1_DY-02]GetSchema("DataTypes")
10:40:43.439 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
10:40:43.485 1 N - [1_1_DY-02]的所有实体类（0个）：
10:40:43.485 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
10:40:43.485 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时47ms
10:40:43.485 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:40:43.512 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
10:40:43.667 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 9, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574336435335093);Select SCOPE_IDENTITY()
10:40:52.592 6 W - [tgm]GetSchema("Tables")
10:40:52.832 6 W - [tgm]GetSchema("Columns")
10:40:52.915 6 W - [tgm]GetSchema("Indexes")
10:40:52.991 6 W - [tgm]GetSchema("IndexColumns")
10:40:53.063 6 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:40:53.130 6 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
10:40:53.199 6 W - Select * From tgm_platform Where id=1
10:40:54.571 8 W - [tgm]GetSchema("Tables")
10:40:54.823 8 W - [tgm]GetSchema("Columns")
10:40:54.913 8 W - [tgm]GetSchema("Indexes")
10:40:54.988 8 W - [tgm]GetSchema("IndexColumns")
10:40:55.064 8 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
10:40:55.133 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:40:55.200 8 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
10:40:55.265 8 W - Select * From tgm_platform Where id=1
10:40:55.332 8 W - Select * From tgm_platform Where id=1
10:41:00.534 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:00.600 7 W - Select * From tgm_platform Order By  createtime desc
10:41:06.060 11 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:06.120 11 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
10:41:06.180 11 W - Select * From tgm_platform Where id=4
10:41:29.948 6 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:30.014 6 W - Select * From tgm_platform Order By  createtime desc
10:41:32.305 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:32.369 7 W - Select * From tgm_role Where id=1
10:41:32.433 7 W - Select * From tgm_platform Where id=4
10:41:32.564 7 W - [tgm]GetSchema("Tables")
10:41:32.795 7 W - [tgm]GetSchema("Columns")
10:41:32.878 7 W - [tgm]GetSchema("Indexes")
10:41:32.948 7 W - [tgm]GetSchema("IndexColumns")
10:41:33.024 7 W - SET NOCOUNT ON;Insert Into tgm_resource(name, pid, sid, player_name, user_code, [time], type, [state], content, gold, coin, exp, honor, fame, spirit, army, devote, props) Values('', 4, 6, '', N'', 635574336924965790, 1, 1, '粉色', 0, 0, 0, 23, 0, 0, 0, 0, '1_1');Select SCOPE_IDENTITY()
10:41:40.091 6 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:40.157 6 W - Select * From tgm_role Where id=1
10:41:40.220 6 W - Select * From tgm_resource Order By id Desc
10:41:40.281 6 W - Select * From tgm_platform Where id in (4,4,4,1,1,1,1,1) Order By id Desc
10:41:40.346 6 W - Select * From tgm_server Where id in (6,6,6,1,1,1,1,1) Order By id Desc
10:41:41.093 8 Y - Select * From tgm_server Order By id Desc
10:41:41.117 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:41:41.145 8 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:41:41.196 8 Y - 单服作业失败
10:41:41.196 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:41:41.219 8 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:41:41.263 8 Y - 单服作业失败
10:41:41.264 8 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:41:41.289 8 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:41:41.308 8 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 9, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574337013076533);Select SCOPE_IDENTITY()
10:41:41.684 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:41.749 9 W - Select * From tgm_platform Order By  createtime desc
10:41:53.406 6 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:53.470 6 W - Select * From tgm_resource Where id=9
10:41:53.535 6 W - Update tgm_resource Set [state]=2, [operation]=N'admin' Where id=9
10:41:55.015 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:55.080 9 W - Select * From tgm_role Where id=1
10:41:55.144 9 W - Select * From tgm_resource Order By id Desc
10:41:55.206 9 W - Select * From tgm_platform Where id in (4,4,4,1,1,1,1,1) Order By id Desc
10:41:55.271 9 W - Select * From tgm_server Where id in (6,6,6,1,1,1,1,1) Order By id Desc
10:41:56.365 6 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:41:56.429 6 W - Select * From tgm_platform Order By  createtime desc
10:42:17.065 6 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
10:42:17.134 6 W - Select * From tgm_platform Order By  createtime desc
10:42:41.105 6 Y - Select * From tgm_server Order By id Desc
10:42:41.149 6 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:42:41.194 6 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
10:42:41.249 6 Y - 单服作业失败
10:42:41.249 6 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:42:41.269 6 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
10:42:41.310 6 Y - 单服作业失败
10:42:41.310 6 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
10:42:41.330 6 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
10:42:41.348 6 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 9, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574337613472908);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 5728
#AppDomain: /LM/W3SVC/2/ROOT-1-130662841914297175
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
11:23:17.670 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
11:23:17.678 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
11:23:17.678 1 N - 使用数据库方式：独占，加大缓存权重
11:23:17.678 1 N - 一级缓存：关闭缓存
11:23:17.710 1 N - [DB]GetSchema("MetaDataCollections")
11:23:17.734 1 N - [DB]GetSchema("ReservedWords")
11:23:17.748 1 N - [DB]GetSchema("Databases", "tgm")
11:23:17.829 1 N - [DB]GetSchema("Tables")
11:23:17.943 1 N - [DB]GetSchema("Columns")
11:23:18.005 1 N - [DB]GetSchema("Indexes")
11:23:18.041 1 N - [DB]GetSchema("IndexColumns")
11:23:18.079 1 N - [DB]GetSchema("DataTypes")
11:23:18.198 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
11:23:18.233 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
11:23:18.311 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
11:23:18.311 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
11:23:18.312 1 N - DB待检查表架构的实体个数：8
11:23:18.437 1 N - 检查连接[DB/SqlServer]的数据库架构耗时204ms
11:23:18.437 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
11:23:18.483 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
11:23:18.505 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

11:23:18.527 1 N - 初始化数据库及脚本
11:23:18.535 1 N - [tgm]GetSchema("MetaDataCollections")
11:23:18.539 1 N - [tgm]GetSchema("ReservedWords")
11:23:18.546 1 N - [tgm]GetSchema("Databases", "tgm")
11:23:18.606 1 N - [tgm]GetSchema("Tables")
11:23:18.716 1 N - [tgm]GetSchema("Columns")
11:23:18.761 1 N - [tgm]GetSchema("Indexes")
11:23:18.799 1 N - [tgm]GetSchema("IndexColumns")
11:23:18.838 1 N - [tgm]GetSchema("DataTypes")
11:23:18.925 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
11:23:18.983 1 N - [tgm]的所有实体类（0个）：
11:23:18.984 1 N - [tgm]需要检查架构的实体类（0个）：
11:23:18.984 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时58ms
11:23:18.984 1 N - Select * From tgm_server Order By id Desc
11:23:19.021 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
11:23:19.024 1 N - [7_1_DY-04]GetSchema("ReservedWords")
11:23:19.029 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
11:23:19.096 1 N - [7_1_DY-04]GetSchema("Tables")
11:23:19.251 1 N - [7_1_DY-04]GetSchema("Columns")
11:23:19.366 1 N - [7_1_DY-04]GetSchema("Indexes")
11:23:19.404 1 N - [7_1_DY-04]GetSchema("IndexColumns")
11:23:19.444 1 N - [7_1_DY-04]GetSchema("DataTypes")
11:23:19.545 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
11:23:19.593 1 N - [7_1_DY-04]的所有实体类（0个）：
11:23:19.593 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
11:23:19.593 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时47ms
11:23:19.593 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:23:19.616 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
11:23:19.673 1 N - 单服作业失败
11:23:19.679 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
11:23:19.682 1 N - [6_4_DY-03]GetSchema("ReservedWords")
11:23:19.688 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
11:23:19.749 1 N - [6_4_DY-03]GetSchema("Tables")
11:23:19.904 1 N - [6_4_DY-03]GetSchema("Columns")
11:23:20.024 1 N - [6_4_DY-03]GetSchema("Indexes")
11:23:20.061 1 N - [6_4_DY-03]GetSchema("IndexColumns")
11:23:20.100 1 N - [6_4_DY-03]GetSchema("DataTypes")
11:23:20.188 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
11:23:20.235 1 N - [6_4_DY-03]的所有实体类（0个）：
11:23:20.235 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
11:23:20.235 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时47ms
11:23:20.235 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:23:20.260 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
11:23:20.306 1 N - 单服作业失败
11:23:20.312 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
11:23:20.315 1 N - [1_1_DY-02]GetSchema("ReservedWords")
11:23:20.321 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
11:23:20.390 1 N - [1_1_DY-02]GetSchema("Tables")
11:23:20.564 1 N - [1_1_DY-02]GetSchema("Columns")
11:23:20.684 1 N - [1_1_DY-02]GetSchema("Indexes")
11:23:20.720 1 N - [1_1_DY-02]GetSchema("IndexColumns")
11:23:20.760 1 N - [1_1_DY-02]GetSchema("DataTypes")
11:23:20.853 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
11:23:20.900 1 N - [1_1_DY-02]的所有实体类（0个）：
11:23:20.900 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
11:23:20.900 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时47ms
11:23:20.900 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:23:20.923 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
11:23:21.076 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574362009446154);Select SCOPE_IDENTITY()
11:23:33.709 7 W - [tgm]GetSchema("Tables")
11:23:33.953 7 W - [tgm]GetSchema("Columns")
11:23:34.035 7 W - [tgm]GetSchema("Indexes")
11:23:34.115 7 W - [tgm]GetSchema("IndexColumns")
11:23:34.190 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
11:23:34.262 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
11:23:34.330 7 W - Select * From tgm_platform Where id=1
11:23:35.682 9 W - [tgm]GetSchema("Tables")
11:23:35.919 9 W - [tgm]GetSchema("Columns")
11:23:36.004 9 W - [tgm]GetSchema("Indexes")
11:23:36.076 9 W - [tgm]GetSchema("IndexColumns")
11:23:36.159 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
11:23:36.227 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
11:23:36.292 9 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
11:23:36.357 9 W - Select * From tgm_platform Where id=1
11:23:36.432 9 W - Select * From tgm_platform Where id=1
11:24:18.549 7 Y - Select * From tgm_server Order By id Desc
11:24:18.597 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:24:18.633 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:24:18.687 7 Y - 单服作业失败
11:24:18.687 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:24:18.714 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:24:18.761 7 Y - 单服作业失败
11:24:18.761 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:24:18.781 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:24:18.798 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574362587976704);Select SCOPE_IDENTITY()
11:25:18.559 7 Y - Select * From tgm_server Order By id Desc
11:25:18.602 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:25:18.637 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:25:18.688 7 Y - 单服作业失败
11:25:18.688 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:25:18.708 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:25:18.752 7 Y - 单服作业失败
11:25:18.752 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:25:18.773 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:25:18.790 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574363187897270);Select SCOPE_IDENTITY()
11:26:18.561 7 Y - Select * From tgm_server Order By id Desc
11:26:18.598 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:26:18.625 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:26:18.669 7 Y - 单服作业失败
11:26:18.669 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:26:18.688 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:26:18.725 7 Y - 单服作业失败
11:26:18.725 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:26:18.753 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:26:18.772 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574363787710874);Select SCOPE_IDENTITY()
11:27:18.576 9 Y - Select * From tgm_server Order By id Desc
11:27:18.618 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:27:18.662 9 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:27:18.742 9 Y - 单服作业失败
11:27:18.743 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:27:18.770 9 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:27:18.808 9 Y - 单服作业失败
11:27:18.808 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:27:18.827 9 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:27:18.843 9 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574364388426005);Select SCOPE_IDENTITY()
11:28:18.576 9 Y - Select * From tgm_server Order By id Desc
11:28:18.619 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:28:18.662 9 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:28:18.723 9 Y - 单服作业失败
11:28:18.723 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:28:18.751 9 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:28:18.794 9 Y - 单服作业失败
11:28:18.794 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:28:18.821 9 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:28:18.839 9 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 12, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574364988381816);Select SCOPE_IDENTITY()
11:29:18.577 11 Y - Select * From tgm_server Order By id Desc
11:29:18.620 11 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:29:18.658 11 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:29:18.702 11 Y - 单服作业失败
11:29:18.702 11 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:29:18.721 11 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:29:18.760 11 Y - 单服作业失败
11:29:18.760 11 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:29:18.779 11 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:29:18.796 11 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574365587959545);Select SCOPE_IDENTITY()
11:30:18.578 9 Y - Select * From tgm_server Order By id Desc
11:30:18.621 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:30:18.666 9 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:30:18.750 9 Y - 单服作业失败
11:30:18.751 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:30:18.794 9 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:30:18.860 9 Y - 单服作业失败
11:30:18.860 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:30:18.883 9 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:30:18.902 9 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574366189010563);Select SCOPE_IDENTITY()
11:31:18.578 15 Y - Select * From tgm_server Order By id Desc
11:31:18.620 15 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:31:18.648 15 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:31:18.686 15 Y - 单服作业失败
11:31:18.686 15 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:31:18.705 15 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:31:18.742 15 Y - 单服作业失败
11:31:18.742 15 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:31:18.761 15 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:31:18.778 15 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574366787774214);Select SCOPE_IDENTITY()
11:32:18.590 15 Y - Select * From tgm_server Order By id Desc
11:32:18.612 15 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:32:18.633 15 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:32:18.675 15 Y - 单服作业失败
11:32:18.676 15 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:32:18.695 15 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:32:18.735 15 Y - 单服作业失败
11:32:18.735 15 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:32:18.757 15 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:32:18.775 15 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574367387740932);Select SCOPE_IDENTITY()
11:33:18.605 11 Y - Select * From tgm_server Order By id Desc
11:33:18.626 11 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:33:18.645 11 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:33:18.682 11 Y - 单服作业失败
11:33:18.682 11 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:33:18.701 11 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:33:18.738 11 Y - 单服作业失败
11:33:18.738 11 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:33:18.767 11 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:33:18.787 11 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574367987865326);Select SCOPE_IDENTITY()
11:34:18.606 16 Y - Select * From tgm_server Order By id Desc
11:34:18.626 16 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:34:18.653 16 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:34:18.690 16 Y - 单服作业失败
11:34:18.691 16 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:34:18.710 16 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:34:18.754 16 Y - 单服作业失败
11:34:18.754 16 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:34:18.774 16 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:34:18.793 16 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574368587925574);Select SCOPE_IDENTITY()
11:35:18.607 14 Y - Select * From tgm_server Order By id Desc
11:35:18.628 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:35:18.650 14 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:35:18.694 14 Y - 单服作业失败
11:35:18.695 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:35:18.716 14 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:35:18.734 14 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 6, 3, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574369187323536);Select SCOPE_IDENTITY()
11:35:18.760 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:35:18.781 14 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:35:18.800 14 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 11, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574369187983972);Select SCOPE_IDENTITY()
11:36:18.621 14 Y - Select * From tgm_server Order By id Desc
11:36:18.640 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:36:18.664 14 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:36:18.705 14 Y - 单服作业失败
11:36:18.705 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:36:18.726 14 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:36:18.744 14 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 6, 3, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574369787438555);Select SCOPE_IDENTITY()
11:36:18.765 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:36:18.786 14 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:36:18.804 14 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 12, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574369788038947);Select SCOPE_IDENTITY()
11:37:18.637 14 Y - Select * From tgm_server Order By id Desc
11:37:18.658 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:37:18.680 14 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
11:37:18.727 14 Y - 单服作业失败
11:37:18.727 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:37:18.750 14 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
11:37:18.770 14 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 6, 3, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574370387685305);Select SCOPE_IDENTITY()
11:37:18.791 14 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
11:37:18.813 14 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
11:37:18.834 14 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 12, 2, 18, 9, 9, 13, 0, 0, 0, 23020, 23020, 635574370388335731);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 7744
#AppDomain: /LM/W3SVC/2/ROOT-1-130662974508553998
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:04:18.936 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:04:18.967 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:04:18.968 1 N - 使用数据库方式：独占，加大缓存权重
15:04:18.968 1 N - 一级缓存：关闭缓存
15:04:18.996 1 N - [DB]GetSchema("MetaDataCollections")
15:04:19.021 1 N - [DB]GetSchema("ReservedWords")
15:04:19.035 1 N - [DB]GetSchema("Databases", "tgm")
15:04:19.125 1 N - [DB]GetSchema("Tables")
15:04:19.249 1 N - [DB]GetSchema("Columns")
15:04:19.300 1 N - [DB]GetSchema("Indexes")
15:04:19.351 1 N - [DB]GetSchema("IndexColumns")
15:04:19.387 1 N - [DB]GetSchema("DataTypes")
15:04:19.494 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:04:19.525 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
15:04:19.604 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:04:19.604 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:04:19.605 1 N - DB待检查表架构的实体个数：8
15:04:19.731 1 N - 检查连接[DB/SqlServer]的数据库架构耗时206ms
15:04:19.731 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
15:04:19.763 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
15:04:19.787 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

15:04:19.810 1 N - 初始化数据库及脚本
15:04:19.818 1 N - [tgm]GetSchema("MetaDataCollections")
15:04:19.821 1 N - [tgm]GetSchema("ReservedWords")
15:04:19.827 1 N - [tgm]GetSchema("Databases", "tgm")
15:04:19.895 1 N - [tgm]GetSchema("Tables")
15:04:20.016 1 N - [tgm]GetSchema("Columns")
15:04:20.060 1 N - [tgm]GetSchema("Indexes")
15:04:20.094 1 N - [tgm]GetSchema("IndexColumns")
15:04:20.127 1 N - [tgm]GetSchema("DataTypes")
15:04:20.211 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
15:04:20.270 1 N - [tgm]的所有实体类（0个）：
15:04:20.270 1 N - [tgm]需要检查架构的实体类（0个）：
15:04:20.270 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时59ms
15:04:20.270 1 N - Select * From tgm_server Order By id Desc
15:04:20.307 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
15:04:20.310 1 N - [7_1_DY-04]GetSchema("ReservedWords")
15:04:20.316 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
15:04:20.392 1 N - [7_1_DY-04]GetSchema("Tables")
15:04:20.558 1 N - [7_1_DY-04]GetSchema("Columns")
15:04:20.672 1 N - [7_1_DY-04]GetSchema("Indexes")
15:04:20.709 1 N - [7_1_DY-04]GetSchema("IndexColumns")
15:04:20.752 1 N - [7_1_DY-04]GetSchema("DataTypes")
15:04:20.844 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
15:04:20.893 1 N - [7_1_DY-04]的所有实体类（0个）：
15:04:20.893 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
15:04:20.893 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时49ms
15:04:20.894 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:04:20.922 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
15:04:20.980 1 N - 单服作业失败
15:04:20.986 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
15:04:20.989 1 N - [6_4_DY-03]GetSchema("ReservedWords")
15:04:20.994 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
15:04:21.062 1 N - [6_4_DY-03]GetSchema("Tables")
15:04:21.224 1 N - [6_4_DY-03]GetSchema("Columns")
15:04:21.353 1 N - [6_4_DY-03]GetSchema("Indexes")
15:04:21.395 1 N - [6_4_DY-03]GetSchema("IndexColumns")
15:04:21.440 1 N - [6_4_DY-03]GetSchema("DataTypes")
15:04:21.537 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
15:04:21.584 1 N - [6_4_DY-03]的所有实体类（0个）：
15:04:21.585 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
15:04:21.585 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时47ms
15:04:21.585 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:04:21.609 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
15:04:21.764 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 0, 9, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574494616313183);Select SCOPE_IDENTITY()
15:04:21.806 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
15:04:21.809 1 N - [1_1_DY-02]GetSchema("ReservedWords")
15:04:21.815 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
15:04:21.881 1 N - [1_1_DY-02]GetSchema("Tables")
15:04:22.046 1 N - [1_1_DY-02]GetSchema("Columns")
15:04:22.183 1 N - [1_1_DY-02]GetSchema("Indexes")
15:04:22.225 1 N - [1_1_DY-02]GetSchema("IndexColumns")
15:04:22.264 1 N - [1_1_DY-02]GetSchema("DataTypes")
15:04:22.355 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
15:04:22.404 1 N - [1_1_DY-02]的所有实体类（0个）：
15:04:22.404 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
15:04:22.404 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时48ms
15:04:22.404 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:04:22.427 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
15:04:22.448 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 17, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574494624470399);Select SCOPE_IDENTITY()
15:05:08.936 7 W - [tgm]GetSchema("Tables")
15:05:09.185 7 W - [tgm]GetSchema("Columns")
15:05:09.271 7 W - [tgm]GetSchema("Indexes")
15:05:09.344 7 W - [tgm]GetSchema("IndexColumns")
15:05:09.417 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:05:09.495 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
15:05:09.565 7 W - Select * From tgm_platform Where id=1
15:05:10.939 8 W - [tgm]GetSchema("Tables")
15:05:11.186 8 W - [tgm]GetSchema("Columns")
15:05:11.274 8 W - [tgm]GetSchema("Indexes")
15:05:11.352 8 W - [tgm]GetSchema("IndexColumns")
15:05:11.427 8 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:05:11.496 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:05:11.561 8 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
15:05:11.623 8 W - Select * From tgm_platform Where id=1
15:05:11.695 8 W - Select * From tgm_platform Where id=1
15:05:16.419 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:05:16.723 7 W - Select * From tgm_notice Where end_time>635574495164862535 and player_id=1 Order By id Desc
15:05:17.837 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:05:17.903 8 W - Select * From tgm_platform Order By  createtime desc
15:05:19.814 7 Y - Select * From tgm_server Order By id Desc
15:05:19.837 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:05:19.860 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
15:05:19.906 7 Y - 单服作业失败
15:05:19.906 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:05:19.929 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
15:05:19.949 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 0, 9, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574495199485546);Select SCOPE_IDENTITY()
15:05:19.972 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:05:19.997 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
15:05:20.019 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 17, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574495200185982);Select SCOPE_IDENTITY()
15:06:19.824 7 Y - Select * From tgm_server Order By id Desc
15:06:19.867 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:06:19.897 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
15:06:19.941 7 Y - 单服作业失败
15:06:19.941 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:06:19.961 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
15:06:19.979 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 0, 9, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574495799789818);Select SCOPE_IDENTITY()
15:06:20.008 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:06:20.030 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
15:06:20.049 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 17, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574495800470273);Select SCOPE_IDENTITY()
15:07:19.825 9 Y - Select * From tgm_server Order By id Desc
15:07:19.846 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:07:19.866 9 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
15:07:19.908 9 Y - 单服作业失败
15:07:19.908 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:07:19.929 9 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
15:07:19.948 9 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 0, 9, 0, 9, 6, 6, 1, 0, 0, 0, 1002000, 1002000, 635574496399468400);Select SCOPE_IDENTITY()
15:07:19.970 9 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:07:19.991 9 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
15:07:20.008 9 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 9, 17, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574496400078805);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 9864
#AppDomain: /LM/W3SVC/2/ROOT-1-130662980424875168
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:14:05.055 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:14:05.066 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:14:05.067 1 N - 使用数据库方式：独占，加大缓存权重
15:14:05.067 1 N - 一级缓存：关闭缓存
15:14:05.136 1 N - [DB]GetSchema("MetaDataCollections")
15:14:05.167 1 N - [DB]GetSchema("ReservedWords")
15:14:05.181 1 N - [DB]GetSchema("Databases", "tgm")
15:14:05.283 1 N - [DB]GetSchema("Tables")
15:14:05.408 1 N - [DB]GetSchema("Columns")
15:14:05.455 1 N - [DB]GetSchema("Indexes")
15:14:05.489 1 N - [DB]GetSchema("IndexColumns")
15:14:05.532 1 N - [DB]GetSchema("DataTypes")
15:14:05.650 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:14:05.685 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
15:14:05.750 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:14:05.750 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:14:05.750 1 N - DB待检查表架构的实体个数：8
15:14:05.882 1 N - 检查连接[DB/SqlServer]的数据库架构耗时196ms
15:14:05.882 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
15:14:05.911 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
15:14:05.934 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

15:14:05.961 1 N - 初始化数据库及脚本
15:14:05.968 1 N - [tgm]GetSchema("MetaDataCollections")
15:14:05.972 1 N - [tgm]GetSchema("ReservedWords")
15:14:05.977 1 N - [tgm]GetSchema("Databases", "tgm")
15:14:06.050 1 N - [tgm]GetSchema("Tables")
15:14:06.174 1 N - [tgm]GetSchema("Columns")
15:14:06.222 1 N - [tgm]GetSchema("Indexes")
15:14:06.257 1 N - [tgm]GetSchema("IndexColumns")
15:14:06.290 1 N - [tgm]GetSchema("DataTypes")
15:14:06.374 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
15:14:06.440 1 N - [tgm]的所有实体类（0个）：
15:14:06.440 1 N - [tgm]需要检查架构的实体类（0个）：
15:14:06.440 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时66ms
15:14:06.440 1 N - Select * From tgm_server Order By id Desc
15:14:06.474 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
15:14:06.477 1 N - [7_1_DY-04]GetSchema("ReservedWords")
15:14:06.483 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
15:14:06.550 1 N - [7_1_DY-04]GetSchema("Tables")
15:14:06.721 1 N - [7_1_DY-04]GetSchema("Columns")
15:14:06.845 1 N - [7_1_DY-04]GetSchema("Indexes")
15:14:06.881 1 N - [7_1_DY-04]GetSchema("IndexColumns")
15:14:06.926 1 N - [7_1_DY-04]GetSchema("DataTypes")
15:14:07.016 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
15:14:07.049 1 N - [7_1_DY-04]的所有实体类（0个）：
15:14:07.050 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
15:14:07.050 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时33ms
15:14:07.050 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:14:07.091 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
15:14:07.145 1 N - 单服作业失败
15:14:07.151 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
15:14:07.154 1 N - [6_4_DY-03]GetSchema("ReservedWords")
15:14:07.160 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
15:14:07.230 1 N - [6_4_DY-03]GetSchema("Tables")
15:14:07.412 1 N - [6_4_DY-03]GetSchema("Columns")
15:14:07.532 1 N - [6_4_DY-03]GetSchema("Indexes")
15:14:07.582 1 N - [6_4_DY-03]GetSchema("IndexColumns")
15:14:07.625 1 N - [6_4_DY-03]GetSchema("DataTypes")
15:14:07.716 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
15:14:07.752 1 N - [6_4_DY-03]的所有实体类（0个）：
15:14:07.752 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
15:14:07.752 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时36ms
15:14:07.753 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:14:07.783 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
15:14:07.945 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574500478041176);Select SCOPE_IDENTITY()
15:14:07.985 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
15:14:07.988 1 N - [1_1_DY-02]GetSchema("ReservedWords")
15:14:07.994 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
15:14:08.062 1 N - [1_1_DY-02]GetSchema("Tables")
15:14:08.225 1 N - [1_1_DY-02]GetSchema("Columns")
15:14:08.344 1 N - [1_1_DY-02]GetSchema("Indexes")
15:14:08.380 1 N - [1_1_DY-02]GetSchema("IndexColumns")
15:14:08.423 1 N - [1_1_DY-02]GetSchema("DataTypes")
15:14:08.512 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
15:14:08.546 1 N - [1_1_DY-02]的所有实体类（0个）：
15:14:08.546 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
15:14:08.546 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时34ms
15:14:08.546 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:14:08.571 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
15:14:08.591 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 19, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574500485906997);Select SCOPE_IDENTITY()
15:14:17.014 7 W - [tgm]GetSchema("Tables")
15:14:17.256 7 W - [tgm]GetSchema("Columns")
15:14:17.340 7 W - [tgm]GetSchema("Indexes")
15:14:17.413 7 W - [tgm]GetSchema("IndexColumns")
15:14:17.490 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:14:17.559 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
15:14:17.626 7 W - Select * From tgm_platform Where id=1
15:14:18.761 9 W - [tgm]GetSchema("Tables")
15:14:19.009 9 W - [tgm]GetSchema("Columns")
15:14:19.094 9 W - [tgm]GetSchema("Indexes")
15:14:19.171 9 W - [tgm]GetSchema("IndexColumns")
15:14:19.251 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:14:19.321 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:14:19.387 9 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
15:14:19.451 9 W - Select * From tgm_platform Where id=1
15:14:19.519 9 W - Select * From tgm_platform Where id=1
15:14:23.591 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:14:23.882 7 W - Select * From tgm_notice Where end_time>635574500636542845 and player_id=1 Order By id Desc
15:14:24.901 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:14:24.971 8 W - Select * From tgm_platform Order By  createtime desc
15:15:05.973 7 Y - Select * From tgm_server Order By id Desc
15:15:06.021 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:15:06.065 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
15:15:06.121 7 Y - 单服作业失败
15:15:06.121 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:15:06.140 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
15:15:06.158 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574501061576866);Select SCOPE_IDENTITY()
15:15:06.178 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:15:06.197 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
15:15:06.215 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 7, 19, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574501062147239);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 10772
#AppDomain: /LM/W3SVC/2/ROOT-1-130662981737174338
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:16:16.355 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:16:16.365 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:16:16.365 1 N - 使用数据库方式：独占，加大缓存权重
15:16:16.365 1 N - 一级缓存：关闭缓存
15:16:16.430 1 N - [DB]GetSchema("MetaDataCollections")
15:16:16.453 1 N - [DB]GetSchema("ReservedWords")
15:16:16.468 1 N - [DB]GetSchema("Databases", "tgm")
15:16:16.562 1 N - [DB]GetSchema("Tables")
15:16:16.693 1 N - [DB]GetSchema("Columns")
15:16:16.738 1 N - [DB]GetSchema("Indexes")
15:16:16.776 1 N - [DB]GetSchema("IndexColumns")
15:16:16.815 1 N - [DB]GetSchema("DataTypes")
15:16:16.934 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)

#Software: iisexpress
#ProcessID: 7936
#AppDomain: /LM/W3SVC/2/ROOT-1-130662981911612326
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:16:33.774 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:16:33.784 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:16:33.785 1 N - 使用数据库方式：独占，加大缓存权重
15:16:33.785 1 N - 一级缓存：关闭缓存
15:16:33.852 1 N - [DB]GetSchema("MetaDataCollections")
15:16:33.877 1 N - [DB]GetSchema("ReservedWords")
15:16:33.890 1 N - [DB]GetSchema("Databases", "tgm")
15:16:33.985 1 N - [DB]GetSchema("Tables")
15:16:34.112 1 N - [DB]GetSchema("Columns")
15:16:34.159 1 N - [DB]GetSchema("Indexes")
15:16:34.195 1 N - [DB]GetSchema("IndexColumns")
15:16:34.239 1 N - [DB]GetSchema("DataTypes")
15:16:34.349 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:16:34.386 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
15:16:34.448 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:16:34.448 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:16:34.448 1 N - DB待检查表架构的实体个数：8
15:16:34.574 1 N - 检查连接[DB/SqlServer]的数据库架构耗时188ms
15:16:34.574 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
15:16:34.602 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
15:16:34.626 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

15:16:34.652 1 N - 初始化数据库及脚本
15:16:34.660 1 N - [tgm]GetSchema("MetaDataCollections")
15:16:34.663 1 N - [tgm]GetSchema("ReservedWords")
15:16:34.668 1 N - [tgm]GetSchema("Databases", "tgm")
15:16:34.739 1 N - [tgm]GetSchema("Tables")
15:16:34.860 1 N - [tgm]GetSchema("Columns")
15:16:34.907 1 N - [tgm]GetSchema("Indexes")
15:16:34.945 1 N - [tgm]GetSchema("IndexColumns")
15:16:34.979 1 N - [tgm]GetSchema("DataTypes")
15:16:35.064 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
15:16:35.100 1 N - [tgm]的所有实体类（0个）：
15:16:35.100 1 N - [tgm]需要检查架构的实体类（0个）：
15:16:35.100 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时36ms
15:16:35.100 1 N - Select * From tgm_server Order By id Desc
15:16:35.135 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
15:16:35.139 1 N - [7_1_DY-04]GetSchema("ReservedWords")
15:16:35.144 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
15:16:35.212 1 N - [7_1_DY-04]GetSchema("Tables")
15:16:35.369 1 N - [7_1_DY-04]GetSchema("Columns")
15:16:35.491 1 N - [7_1_DY-04]GetSchema("Indexes")
15:16:35.526 1 N - [7_1_DY-04]GetSchema("IndexColumns")
15:16:35.565 1 N - [7_1_DY-04]GetSchema("DataTypes")
15:16:35.655 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
15:16:35.689 1 N - [7_1_DY-04]的所有实体类（0个）：
15:16:35.690 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
15:16:35.690 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时35ms
15:16:35.690 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:16:35.732 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
15:16:35.789 1 N - 单服作业失败
15:16:35.796 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
15:16:35.800 1 N - [6_4_DY-03]GetSchema("ReservedWords")
15:16:35.806 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
15:16:35.888 1 N - [6_4_DY-03]GetSchema("Tables")
15:16:36.049 1 N - [6_4_DY-03]GetSchema("Columns")
15:16:36.175 1 N - [6_4_DY-03]GetSchema("Indexes")
15:16:36.217 1 N - [6_4_DY-03]GetSchema("IndexColumns")
15:16:36.258 1 N - [6_4_DY-03]GetSchema("DataTypes")
15:16:36.356 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
15:16:36.390 1 N - [6_4_DY-03]的所有实体类（0个）：
15:16:36.390 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
15:16:36.390 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时34ms
15:16:36.390 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:16:36.415 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
15:16:36.568 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574501964367337);Select SCOPE_IDENTITY()
15:16:36.609 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
15:16:36.612 1 N - [1_1_DY-02]GetSchema("ReservedWords")
15:16:36.619 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
15:16:36.686 1 N - [1_1_DY-02]GetSchema("Tables")
15:16:36.852 1 N - [1_1_DY-02]GetSchema("Columns")
15:16:36.974 1 N - [1_1_DY-02]GetSchema("Indexes")
15:16:37.018 1 N - [1_1_DY-02]GetSchema("IndexColumns")
15:16:37.059 1 N - [1_1_DY-02]GetSchema("DataTypes")
15:16:37.147 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
15:16:37.181 1 N - [1_1_DY-02]的所有实体类（0个）：
15:16:37.181 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
15:16:37.181 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时34ms
15:16:37.181 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:16:37.207 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
15:16:37.227 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 20, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574501972262902);Select SCOPE_IDENTITY()
15:16:43.445 7 W - [tgm]GetSchema("Tables")
15:16:43.694 7 W - [tgm]GetSchema("Columns")
15:16:43.780 7 W - [tgm]GetSchema("Indexes")
15:16:43.853 7 W - [tgm]GetSchema("IndexColumns")
15:16:43.926 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:16:43.997 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
15:16:44.067 7 W - Select * From tgm_platform Where id=1
15:16:45.208 9 W - [tgm]GetSchema("Tables")
15:16:45.454 9 W - [tgm]GetSchema("Columns")
15:16:45.537 9 W - [tgm]GetSchema("Indexes")
15:16:45.611 9 W - [tgm]GetSchema("IndexColumns")
15:16:45.688 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:16:45.761 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:16:45.825 9 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
15:16:45.888 9 W - Select * From tgm_platform Where id=1
15:16:45.954 9 W - Select * From tgm_platform Where id=1
15:16:49.780 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:16:49.910 8 W - [tgm]GetSchema("Tables")
15:16:50.141 8 W - [tgm]GetSchema("Columns")
15:16:50.222 8 W - [tgm]GetSchema("Indexes")
15:16:50.293 8 W - [tgm]GetSchema("IndexColumns")
15:16:50.365 8 W - Select * From tgm_notice Where end_time>635574502098453405 and player_id=1 Order By id Desc
15:16:51.335 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:16:51.402 7 W - Select * From tgm_platform Order By  createtime desc

#Software: iisexpress
#ProcessID: 4752
#AppDomain: /LM/W3SVC/2/ROOT-1-130662982606597927
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:17:43.263 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:17:43.272 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:17:43.272 1 N - 使用数据库方式：独占，加大缓存权重
15:17:43.272 1 N - 一级缓存：关闭缓存
15:17:43.341 1 N - [DB]GetSchema("MetaDataCollections")
15:17:43.365 1 N - [DB]GetSchema("ReservedWords")
15:17:43.379 1 N - [DB]GetSchema("Databases", "tgm")
15:17:43.485 1 N - [DB]GetSchema("Tables")
15:17:43.609 1 N - [DB]GetSchema("Columns")
15:17:43.658 1 N - [DB]GetSchema("Indexes")
15:17:43.694 1 N - [DB]GetSchema("IndexColumns")
15:17:43.736 1 N - [DB]GetSchema("DataTypes")
15:17:43.846 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:17:43.884 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
15:17:43.946 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:17:43.946 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:17:43.947 1 N - DB待检查表架构的实体个数：8
15:17:44.075 1 N - 检查连接[DB/SqlServer]的数据库架构耗时190ms
15:17:44.075 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
15:17:44.104 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
15:17:44.127 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

15:17:44.151 1 N - 初始化数据库及脚本
15:17:44.158 1 N - [tgm]GetSchema("MetaDataCollections")
15:17:44.162 1 N - [tgm]GetSchema("ReservedWords")
15:17:44.167 1 N - [tgm]GetSchema("Databases", "tgm")
15:17:44.236 1 N - [tgm]GetSchema("Tables")
15:17:44.363 1 N - [tgm]GetSchema("Columns")
15:17:44.406 1 N - [tgm]GetSchema("Indexes")
15:17:44.440 1 N - [tgm]GetSchema("IndexColumns")
15:17:44.474 1 N - [tgm]GetSchema("DataTypes")
15:17:44.558 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
15:17:44.593 1 N - [tgm]的所有实体类（0个）：
15:17:44.593 1 N - [tgm]需要检查架构的实体类（0个）：
15:17:44.593 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时35ms
15:17:44.593 1 N - Select * From tgm_server Order By id Desc
15:17:44.630 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
15:17:44.633 1 N - [7_1_DY-04]GetSchema("ReservedWords")
15:17:44.639 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
15:17:44.708 1 N - [7_1_DY-04]GetSchema("Tables")
15:17:44.884 1 N - [7_1_DY-04]GetSchema("Columns")
15:17:45.002 1 N - [7_1_DY-04]GetSchema("Indexes")
15:17:45.037 1 N - [7_1_DY-04]GetSchema("IndexColumns")
15:17:45.076 1 N - [7_1_DY-04]GetSchema("DataTypes")
15:17:45.163 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
15:17:45.208 1 N - [7_1_DY-04]的所有实体类（0个）：
15:17:45.208 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
15:17:45.208 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时45ms
15:17:45.208 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:17:45.250 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
15:17:45.306 1 N - 单服作业失败
15:17:45.311 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
15:17:45.314 1 N - [6_4_DY-03]GetSchema("ReservedWords")
15:17:45.322 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
15:17:45.387 1 N - [6_4_DY-03]GetSchema("Tables")
15:17:45.546 1 N - [6_4_DY-03]GetSchema("Columns")
15:17:45.673 1 N - [6_4_DY-03]GetSchema("Indexes")
15:17:45.708 1 N - [6_4_DY-03]GetSchema("IndexColumns")
15:17:45.751 1 N - [6_4_DY-03]GetSchema("DataTypes")
15:17:45.839 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
15:17:45.873 1 N - [6_4_DY-03]的所有实体类（0个）：
15:17:45.873 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
15:17:45.873 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时34ms
15:17:45.873 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:17:45.898 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
15:17:46.053 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574502659205013);Select SCOPE_IDENTITY()
15:17:46.097 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
15:17:46.101 1 N - [1_1_DY-02]GetSchema("ReservedWords")
15:17:46.107 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
15:17:46.173 1 N - [1_1_DY-02]GetSchema("Tables")
15:17:46.329 1 N - [1_1_DY-02]GetSchema("Columns")
15:17:46.445 1 N - [1_1_DY-02]GetSchema("Indexes")
15:17:46.481 1 N - [1_1_DY-02]GetSchema("IndexColumns")
15:17:46.522 1 N - [1_1_DY-02]GetSchema("DataTypes")
15:17:46.614 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
15:17:46.647 1 N - [1_1_DY-02]的所有实体类（0个）：
15:17:46.647 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
15:17:46.647 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时34ms
15:17:46.647 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:17:46.671 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
15:17:46.691 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 20, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574502666900971);Select SCOPE_IDENTITY()
15:17:52.131 9 W - [tgm]GetSchema("Tables")
15:17:52.373 9 W - [tgm]GetSchema("Columns")
15:17:52.459 9 W - [tgm]GetSchema("Indexes")
15:17:52.540 9 W - [tgm]GetSchema("IndexColumns")
15:17:52.617 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:17:52.684 9 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
15:17:52.756 9 W - Select * From tgm_platform Where id=1
15:17:54.028 8 W - [tgm]GetSchema("Tables")
15:17:54.268 8 W - [tgm]GetSchema("Columns")
15:17:54.360 8 W - [tgm]GetSchema("Indexes")
15:17:54.435 8 W - [tgm]GetSchema("IndexColumns")
15:17:54.511 8 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:17:54.581 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:17:54.649 8 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
15:17:54.712 8 W - Select * From tgm_platform Where id=1
15:17:54.779 8 W - Select * From tgm_platform Where id=1
15:17:58.355 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:17:58.489 7 W - [tgm]GetSchema("Tables")
15:17:58.728 7 W - [tgm]GetSchema("Columns")
15:17:58.812 7 W - [tgm]GetSchema("Indexes")
15:17:58.883 7 W - [tgm]GetSchema("IndexColumns")
15:17:58.958 7 W - Select * From tgm_notice Where end_time>635574502784212975 and player_id=1 Order By id Desc
15:17:59.971 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:18:00.037 8 W - Select * From tgm_platform Order By  createtime desc
15:18:10.842 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:18:10.905 7 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
15:18:10.965 7 W - Select * From tgm_platform Where id=4

#Software: iisexpress
#ProcessID: 10404
#AppDomain: /LM/W3SVC/2/ROOT-1-130662984026943159
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:20:05.296 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:20:05.306 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:20:05.306 1 N - 使用数据库方式：独占，加大缓存权重
15:20:05.306 1 N - 一级缓存：关闭缓存
15:20:05.372 1 N - [DB]GetSchema("MetaDataCollections")
15:20:05.397 1 N - [DB]GetSchema("ReservedWords")
15:20:05.412 1 N - [DB]GetSchema("Databases", "tgm")
15:20:05.509 1 N - [DB]GetSchema("Tables")
15:20:05.635 1 N - [DB]GetSchema("Columns")
15:20:05.680 1 N - [DB]GetSchema("Indexes")
15:20:05.717 1 N - [DB]GetSchema("IndexColumns")
15:20:05.763 1 N - [DB]GetSchema("DataTypes")
15:20:05.877 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:20:05.914 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
15:20:05.977 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:20:05.977 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:20:05.978 1 N - DB待检查表架构的实体个数：8
15:20:06.105 1 N - 检查连接[DB/SqlServer]的数据库架构耗时192ms
15:20:06.106 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
15:20:06.134 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
15:20:06.159 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

15:20:06.184 1 N - 初始化数据库及脚本
15:20:06.191 1 N - [tgm]GetSchema("MetaDataCollections")
15:20:06.194 1 N - [tgm]GetSchema("ReservedWords")
15:20:06.199 1 N - [tgm]GetSchema("Databases", "tgm")
15:20:06.271 1 N - [tgm]GetSchema("Tables")
15:20:06.392 1 N - [tgm]GetSchema("Columns")
15:20:06.434 1 N - [tgm]GetSchema("Indexes")
15:20:06.470 1 N - [tgm]GetSchema("IndexColumns")
15:20:06.503 1 N - [tgm]GetSchema("DataTypes")
15:20:06.589 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
15:20:06.630 1 N - [tgm]的所有实体类（0个）：
15:20:06.630 1 N - [tgm]需要检查架构的实体类（0个）：
15:20:06.630 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时41ms
15:20:06.630 1 N - Select * From tgm_server Order By id Desc
15:20:06.665 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
15:20:06.668 1 N - [7_1_DY-04]GetSchema("ReservedWords")
15:20:06.674 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
15:20:06.757 1 N - [7_1_DY-04]GetSchema("Tables")
15:20:06.913 1 N - [7_1_DY-04]GetSchema("Columns")
15:20:07.026 1 N - [7_1_DY-04]GetSchema("Indexes")
15:20:07.066 1 N - [7_1_DY-04]GetSchema("IndexColumns")
15:20:07.104 1 N - [7_1_DY-04]GetSchema("DataTypes")
15:20:07.193 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
15:20:07.227 1 N - [7_1_DY-04]的所有实体类（0个）：
15:20:07.227 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
15:20:07.227 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时34ms
15:20:07.227 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:20:07.268 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
15:20:07.324 1 N - 单服作业失败
15:20:07.330 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
15:20:07.333 1 N - [6_4_DY-03]GetSchema("ReservedWords")
15:20:07.339 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
15:20:07.407 1 N - [6_4_DY-03]GetSchema("Tables")
15:20:07.576 1 N - [6_4_DY-03]GetSchema("Columns")
15:20:07.703 1 N - [6_4_DY-03]GetSchema("Indexes")
15:20:07.751 1 N - [6_4_DY-03]GetSchema("IndexColumns")
15:20:07.790 1 N - [6_4_DY-03]GetSchema("DataTypes")
15:20:07.878 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
15:20:07.912 1 N - [6_4_DY-03]的所有实体类（0个）：
15:20:07.912 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
15:20:07.912 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时34ms
15:20:07.912 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:20:07.936 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
15:20:08.094 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574504079589493);Select SCOPE_IDENTITY()
15:20:08.134 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
15:20:08.137 1 N - [1_1_DY-02]GetSchema("ReservedWords")
15:20:08.143 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
15:20:08.209 1 N - [1_1_DY-02]GetSchema("Tables")
15:20:08.365 1 N - [1_1_DY-02]GetSchema("Columns")
15:20:08.486 1 N - [1_1_DY-02]GetSchema("Indexes")
15:20:08.542 1 N - [1_1_DY-02]GetSchema("IndexColumns")
15:20:08.584 1 N - [1_1_DY-02]GetSchema("DataTypes")
15:20:08.671 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
15:20:08.705 1 N - [1_1_DY-02]的所有实体类（0个）：
15:20:08.705 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
15:20:08.705 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时34ms
15:20:08.706 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:20:08.730 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
15:20:08.754 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 20, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574504087534763);Select SCOPE_IDENTITY()
15:20:15.610 7 W - [tgm]GetSchema("Tables")
15:20:15.848 7 W - [tgm]GetSchema("Columns")
15:20:15.936 7 W - [tgm]GetSchema("Indexes")
15:20:16.008 7 W - [tgm]GetSchema("IndexColumns")
15:20:16.082 7 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:20:16.150 7 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
15:20:16.221 7 W - Select * From tgm_platform Where id=1
15:20:17.658 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:20:17.723 7 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
15:20:17.787 7 W - Select * From tgm_platform Where id=1
15:20:17.854 7 W - Select * From tgm_platform Where id=1
15:20:21.699 9 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:20:21.832 9 W - [tgm]GetSchema("Tables")
15:20:22.068 9 W - [tgm]GetSchema("Columns")
15:20:22.148 9 W - [tgm]GetSchema("Indexes")
15:20:22.220 9 W - [tgm]GetSchema("IndexColumns")
15:20:22.297 9 W - Select * From tgm_notice Where end_time>635574504217668060 and player_id=1 Order By id Desc
15:20:23.285 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:20:23.351 7 W - Select * From tgm_platform Order By  createtime desc
15:20:36.124 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:20:36.186 7 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
15:20:36.245 7 W - Select * From tgm_platform Where id=4
15:20:39.808 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:20:39.871 7 W - Select * From tgm_server Where [pid] =1  Order By  createtime desc
15:20:39.929 7 W - Select * From tgm_platform Where id=1
15:20:39.991 7 W - Select * From tgm_platform Where id=1
15:20:42.703 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:20:42.763 7 W - Select * From tgm_server Where [pid] =4  Order By  createtime desc
15:20:42.821 7 W - Select * From tgm_platform Where id=4
15:21:06.190 7 Y - Select * From tgm_server Order By id Desc
15:21:06.237 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:21:06.274 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
15:21:06.318 7 Y - 单服作业失败
15:21:06.319 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:21:06.345 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
15:21:06.362 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574504663610582);Select SCOPE_IDENTITY()
15:21:06.381 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:21:06.401 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
15:21:06.418 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 20, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574504664170944);Select SCOPE_IDENTITY()
15:22:06.185 7 Y - Select * From tgm_server Order By id Desc
15:22:06.210 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:22:06.245 7 Y - [StoredProcedure]sp_pay[Int32:@sid=7]
15:22:06.288 7 Y - 单服作业失败
15:22:06.289 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:22:06.308 7 Y - [StoredProcedure]sp_pay[Int32:@sid=6]
15:22:06.325 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574505263245573);Select SCOPE_IDENTITY()
15:22:06.345 7 Y - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:22:06.365 7 Y - [StoredProcedure]sp_pay[Int32:@sid=1]
15:22:06.382 7 Y - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 20, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574505263815952);Select SCOPE_IDENTITY()

#Software: iisexpress
#ProcessID: 8848
#AppDomain: /LM/W3SVC/2/ROOT-1-130662986372004208
#FileName: C:\Program Files (x86)\IIS Express\iisexpress.exe
#BaseDirectory: E:\192.168.1.254\TGG\管理后台\TGM\TGM.API\
#CurrentDirectory: C:\Program Files (x86)\IIS Express
#CommandLine: /config:"C:\Users\TH\Documents\IISExpress\config\applicationhost.config"  /site:"TGM.API" /apppool:"Clr4IntegratedAppPool"
#ApplicationType: Console
#CLR: 4.0.30319.34014
#OS: Windows 8 x64, TH/TH_KAER
#Date: 2015-01-21
#Fields: Time ThreadID IsPoolThread ThreadName Message
15:23:59.764 1 N - NewLife.Core v4.6.2014.0731 Build 2014-08-30 18:12:06
15:23:59.772 1 N - NewLife.XCode v8.13.2014.0720 Build 2014-08-30 18:10:56
15:23:59.773 1 N - 使用数据库方式：独占，加大缓存权重
15:23:59.773 1 N - 一级缓存：关闭缓存
15:23:59.838 1 N - [DB]GetSchema("MetaDataCollections")
15:23:59.864 1 N - [DB]GetSchema("ReservedWords")
15:23:59.877 1 N - [DB]GetSchema("Databases", "tgm")
15:23:59.966 1 N - [DB]GetSchema("Tables")
15:24:00.115 1 N - [DB]GetSchema("Columns")
15:24:00.160 1 N - [DB]GetSchema("Indexes")
15:24:00.196 1 N - [DB]GetSchema("IndexColumns")
15:24:00.244 1 N - [DB]GetSchema("DataTypes")
15:24:00.361 1 N - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:24:00.396 1 N - 开始检查连接[DB/SqlServer]的数据库架构……
15:24:00.459 1 N - [DB]的所有实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:24:00.459 1 N - [DB]需要检查架构的实体类（9个）：tgm_gm,tgm_notice,tgm_platform,tgm_record_game,tgm_record_hours,tgm_record_pay,tgm_resource,tgm_role,tgm_server
15:24:00.460 1 N - DB待检查表架构的实体个数：8
15:24:00.586 1 N - 检查连接[DB/SqlServer]的数据库架构耗时191ms
15:24:00.586 1 N - Select Top 1 * From tgm_platform Where id=0 Order By id Desc
15:24:00.616 1 N - Select Top 1 * From tgm_role Where id=0 Order By id Desc
15:24:00.638 1 N - IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
DROP TRIGGER [trigger_pay_insert]
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
DROP PROCEDURE [sp_pay]

IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[sp_pay]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [sp_pay]
@sid INT
AS
BEGIN
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 	
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	IF @pay_taday IS NULL
		SET @pay_taday=0;
	IF @pay_total IS NULL
		SET @pay_total=0;
	IF @pay_month IS NULL
		SET @pay_month=0;
	SELECT @pay_count AS pay_count,@pay_number AS pay_number,@pay_taday AS pay_taday,@pay_total AS pay_total,@pay_month AS pay_month	
END
' 
END

IF NOT EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'[trigger_pay_insert]'))
EXEC dbo.sp_executesql @statement = N'
CREATE TRIGGER [trigger_pay_insert]
   ON [tgm_record_pay]
   AFTER  INSERT
AS 
BEGIN
	DECLARE @sid INT, @amount INT,@createtime BIGINT,@ID BIGINT;
	DECLARE @_begin_time BIGINT,@_taday_time BIGINT,@_next_time BIGINT,@_end_time BIGINT;
	SET @_taday_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_next_time=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',GETDATE()+1) AS BIGINT) * 10000000 + 621355968000000000 
	SET @_begin_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_taday_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @_end_time=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@_next_time-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 		
	SELECT @sid =[sid], @amount = [amount],@createtime=[createtime] FROM inserted;
	DECLARE @pay_count INT,@pay_number INT,@pay_taday INT,@pay_total INT,@pay_month INT;
	--今日充值人数
	SELECT @pay_number=COUNT(*) FROM (SELECT DISTINCT [id] FROM [tgm_record_pay] WHERE  [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time) AS T
	--今日充值次数
	SELECT @pay_count=COUNT(*) FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time	
	--当天总充值
	SELECT @pay_taday=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@_begin_time AND [createtime]<@_end_time
	--总充值
	SELECT @pay_total=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid 
	DECLARE @time_0 BIGINT,@time_31 BIGINT,@M_BEGIN BIGINT,@M_END BIGINT;
	SET @M_BEGIN=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE())+1,GETDATE())) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_0=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_BEGIN-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	SET @M_END=CAST(DATEDIFF(s,''1970-01-01 00:00:00'',DATEADD(D,-DAY(GETDATE()),DATEADD(M,1,GETDATE()))) AS BIGINT) * 10000000 + 621355968000000000 
	SET @time_31=(CAST(DATEDIFF(d,''1970-01-01 00:00:00'',DATEADD(s,(@M_END-621355968000000000)/ 10000000,''1970-01-01 00:00:00''))AS BIGINT) * 10000000*24*60*60 + 621355968000000000); 
	--当月充值
	SELECT @pay_month=SUM([amount])  FROM [tgm_record_pay] WHERE [sid]=@sid AND [createtime]>@M_BEGIN AND [createtime]<@M_END
	SET @pay_count+=1;
	SELECT TOP 1 @ID=id FROM [tgm_record_hours] WHERE sid=@sid ORDER BY createtime DESC
	UPDATE [tgm_record_hours] SET [pay_count]=@pay_count,[pay_number]=@pay_number,[pay_taday]=@pay_taday,[pay_total]=@pay_total,[pay_month]=@pay_month
	WHERE [id]=@ID
END
' 

15:24:00.664 1 N - 初始化数据库及脚本
15:24:00.671 1 N - [tgm]GetSchema("MetaDataCollections")
15:24:00.674 1 N - [tgm]GetSchema("ReservedWords")
15:24:00.681 1 N - [tgm]GetSchema("Databases", "tgm")
15:24:00.757 1 N - [tgm]GetSchema("Tables")
15:24:00.879 1 N - [tgm]GetSchema("Columns")
15:24:00.926 1 N - [tgm]GetSchema("Indexes")
15:24:00.960 1 N - [tgm]GetSchema("IndexColumns")
15:24:00.994 1 N - [tgm]GetSchema("DataTypes")
15:24:01.077 1 N - 开始检查连接[tgm/SqlServer]的数据库架构……
15:24:01.114 1 N - [tgm]的所有实体类（0个）：
15:24:01.114 1 N - [tgm]需要检查架构的实体类（0个）：
15:24:01.114 1 N - 检查连接[tgm/SqlServer]的数据库架构耗时36ms
15:24:01.114 1 N - Select * From tgm_server Order By id Desc
15:24:01.150 1 N - [7_1_DY-04]GetSchema("MetaDataCollections")
15:24:01.153 1 N - [7_1_DY-04]GetSchema("ReservedWords")
15:24:01.160 1 N - [7_1_DY-04]GetSchema("Databases", "tgg2")
15:24:01.228 1 N - [7_1_DY-04]GetSchema("Tables")
15:24:01.413 1 N - [7_1_DY-04]GetSchema("Columns")
15:24:01.529 1 N - [7_1_DY-04]GetSchema("Indexes")
15:24:01.566 1 N - [7_1_DY-04]GetSchema("IndexColumns")
15:24:01.605 1 N - [7_1_DY-04]GetSchema("DataTypes")
15:24:01.692 1 N - 开始检查连接[7_1_DY-04/SqlServer]的数据库架构……
15:24:01.726 1 N - [7_1_DY-04]的所有实体类（0个）：
15:24:01.726 1 N - [7_1_DY-04]需要检查架构的实体类（0个）：
15:24:01.726 1 N - 检查连接[7_1_DY-04/SqlServer]的数据库架构耗时34ms
15:24:01.726 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:24:01.771 1 N - [StoredProcedure]sp_pay[Int32:@sid=7]
15:24:01.825 1 N - 单服作业失败
15:24:01.830 1 N - [6_4_DY-03]GetSchema("MetaDataCollections")
15:24:01.833 1 N - [6_4_DY-03]GetSchema("ReservedWords")
15:24:01.839 1 N - [6_4_DY-03]GetSchema("Databases", "tgg")
15:24:01.908 1 N - [6_4_DY-03]GetSchema("Tables")
15:24:02.065 1 N - [6_4_DY-03]GetSchema("Columns")
15:24:02.181 1 N - [6_4_DY-03]GetSchema("Indexes")
15:24:02.220 1 N - [6_4_DY-03]GetSchema("IndexColumns")
15:24:02.260 1 N - [6_4_DY-03]GetSchema("DataTypes")
15:24:02.351 1 N - 开始检查连接[6_4_DY-03/SqlServer]的数据库架构……
15:24:02.385 1 N - [6_4_DY-03]的所有实体类（0个）：
15:24:02.385 1 N - [6_4_DY-03]需要检查架构的实体类（0个）：
15:24:02.385 1 N - 检查连接[6_4_DY-03/SqlServer]的数据库架构耗时34ms
15:24:02.385 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:24:02.414 1 N - [StoredProcedure]sp_pay[Int32:@sid=6]
15:24:02.568 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(4, 6, N'DY-03', 1, 9, 1, 10, 6, 6, 2, 0, 0, 0, 1002000, 1002000, 635574506424368966);Select SCOPE_IDENTITY()
15:24:02.609 1 N - [1_1_DY-02]GetSchema("MetaDataCollections")
15:24:02.612 1 N - [1_1_DY-02]GetSchema("ReservedWords")
15:24:02.617 1 N - [1_1_DY-02]GetSchema("Databases", "tg_test")
15:24:02.687 1 N - [1_1_DY-02]GetSchema("Tables")
15:24:02.855 1 N - [1_1_DY-02]GetSchema("Columns")
15:24:02.984 1 N - [1_1_DY-02]GetSchema("Indexes")
15:24:03.022 1 N - [1_1_DY-02]GetSchema("IndexColumns")
15:24:03.065 1 N - [1_1_DY-02]GetSchema("DataTypes")
15:24:03.154 1 N - 开始检查连接[1_1_DY-02/SqlServer]的数据库架构……
15:24:03.188 1 N - [1_1_DY-02]的所有实体类（0个）：
15:24:03.188 1 N - [1_1_DY-02]需要检查架构的实体类（0个）：
15:24:03.188 1 N - 检查连接[1_1_DY-02/SqlServer]的数据库架构耗时34ms
15:24:03.189 1 N - Select Top 1 * From report_day Where  createtime >635573952000000000 and createtime<635574816000000000 Order By id Desc
15:24:03.212 1 N - [StoredProcedure]sp_pay[Int32:@sid=1]
15:24:03.234 1 N - SET NOCOUNT ON;Insert Into tgm_record_hours(pid, sid, server_name, online, offline, register, register_total, taday_online, history_online, taday_login, pay_number, pay_count, pay_taday, pay_total, pay_month, createtime) Values(1, 1, N'DY-02', 6, 20, 10, 26, 10, 10, 23, 0, 0, 0, 23020, 23020, 635574506432337669);Select SCOPE_IDENTITY()
15:24:08.816 9 W - [tgm]GetSchema("Tables")
15:24:09.056 9 W - [tgm]GetSchema("Columns")
15:24:09.140 9 W - [tgm]GetSchema("Indexes")
15:24:09.215 9 W - [tgm]GetSchema("IndexColumns")
15:24:09.289 9 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:24:09.363 9 W - Select Top 1 * From tgm_role Where name=N'admin' Order By id Desc
15:24:09.434 9 W - Select * From tgm_platform Where id=1
15:24:10.726 8 W - [tgm]GetSchema("Tables")
15:24:10.971 8 W - [tgm]GetSchema("Columns")
15:24:11.056 8 W - [tgm]GetSchema("Indexes")
15:24:11.137 8 W - [tgm]GetSchema("IndexColumns")
15:24:11.214 8 W - select object_name(id) as objname,rows from sysindexes where indid in (0,1) and status in (0,2066)
15:24:11.289 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:24:11.354 8 W - Select * From tgm_server Where  pid in  (select id from tgm_platform where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3') Order By id Desc
15:24:11.421 8 W - Select * From tgm_platform Where id=1
15:24:11.490 8 W - Select * From tgm_platform Where id=1
15:24:16.607 7 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:24:16.746 7 W - [tgm]GetSchema("Tables")
15:24:16.974 7 W - [tgm]GetSchema("Columns")
15:24:17.057 7 W - [tgm]GetSchema("Indexes")
15:24:17.129 7 W - [tgm]GetSchema("IndexColumns")
15:24:17.200 7 W - Select * From tgm_notice Where end_time>635574506566781844 and player_id=1 Order By id Desc
15:24:18.195 8 W - Select Top 1 * From tgm_platform Where token='0c372ec3-1b00-4286-84a8-9216e7ab59e3' Order By id Desc
15:24:18.259 8 W - Select * From tgm_platform Order By  createtime desc
